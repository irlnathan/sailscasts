
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>sailsCasts</title>
  <meta name="author" content="irl nathan">

  
  <meta name="description" content="Follow me on twitter here. Subscribe to the sailscasts mailing list here. The repo for this episode can be found here. Transcript In &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://irlnathan.github.io/sailscasts">
  <link href="/sailscasts/favicon.png" rel="icon">
  <link href="/sailscasts/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/sailscasts/atom.xml" rel="alternate" title="sailsCasts" type="application/atom+xml">
  <script src="/sailscasts/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/sailscasts/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43421644-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/sailscasts/">sailsCasts</a></h1>
  
    <h2>Learning about sails.js one screencast at a time.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/sailscasts/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:irlnathan.github.io/sailscasts" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/sailscasts/">Blog</a></li>
  <li><a href="/sailscasts/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/">Building an Angular Application in Sails: Ep3 - Understanding Asset Delivery Options in Our SignUp Page.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-20T16:12:00-06:00" pubdate data-updated="true">Jan 20<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/4keciyLVPiM" frameborder="0" allowfullscreen></iframe>


<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<p>The repo for this episode can be found <a href="https://github.com/irlnathan/activityoverlord20">here</a>.</p>

<h1>Transcript</h1>

<p>In activityOverlord v1.0 the user interface or <code>Views</code> of the app were built primarily on the server before being sent to the client and rendered by the client&rsquo;s browser.  This approach is the <code>V</code> of the <strong>MVC architecture</strong> and also known as <strong>Server Rendering</strong> even though the web page is actually being rendered on the client&rsquo;s browser.</p>

<p>This so called <em>Server Rendering</em> is the server preprocessing one or more templates of markup, usually some combination of HTML, CSS, and Javascript and combining them with data via a <strong>Template Engine</strong>.  All <em>template engines</em> use some form of tags that surround variables that when processed yield a result.  Sails uses the EJS template engine by default.  For example, this template contains some standard HTML mark-up along with <code>EJS</code> tags.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!DOCTYPE html&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>  &lt;head&gt;
</span><span class='line'>    &lt;title&gt;&lt;%- title %&gt;&lt;/title&gt;
</span><span class='line'>  &lt;/head&gt;
</span><span class='line'>  ...
</span></code></pre></td></tr></table></div></figure>


<p>Between the tags is a variable <code>title</code>.  When the Sails server processes this template it will attempt to replace the <code>title</code> variable with a value, hopefully the page title.  This is also called <strong>String Interpolation</strong>, but I only mention that because I&rsquo;m a geek.</p>

<h3>Server Rendered Views</h3>

<p>So let&rsquo;s review this approach. When a client browser makes a <code>request</code> to the server, the <code>router</code> parses the <code>request</code> and determines where to send it.  Now, the resulting <code>route</code> typically points to a <code>controller/action</code> that might execute some logic. For example, that logic might include accessing a mongo database that retrieves a stored twitter id and access token.  The id and token are then used to request additional details of the user from the Twitter API, all before the server pre-processes a template which contains tags with variables that are replaced by the Twitter details into a <code>View</code>.  The <code>View</code> is then sent back to the client and ultimately rendered by the browser.</p>

<p>Now, this traditional approach to web applications has at least two weaknesses.  First, its reliance on the server for page creation means the responsiveness of the app is impeded by the constant round trips necessary to update changes to the <code>View</code> from the server.  Second, is that the API being tightly coupled to the <code>View</code> makes it less flexible for other potential consumers to use.</p>

<p>A more modern approach to web applications solves both weaknesses by pushing the responsibility for changing the UI to the client as well as decoupling the API to act as an independent provider of endpoints.  These endpoints can then be accessed by the browser UI, a native app UI, a mobile UI, or even a smart refrigerator UI.</p>

<p>Now this doesn&rsquo;t mean that we&rsquo;ll be abandoning Server Rendered Views entirely.  Instead activityOverlordv2.0 will take a hybrid approach using a blend of Server Rendered Views combined with Front-end Framework Components to deliver a UI that makes authentication and SEO manageable.  But as usual I&rsquo;m getting ahead of myself.</p>

<p>So let&rsquo;s go back to the project and see what Server Rendered Views look like in action.  By default, Sails generated  three files &mdash; <code>homepage.ejs</code>, <code>layout.ejs</code>, and a route to the homepage contained in <code>/config/route.js</code>.  So when I make a request in the browser to localhost:1337, the Sails router looks at the request and matches it with the <code>route</code> in the routes file (e.g. <code>route.js</code>).  This triggers the <em>View Engine</em> to pre-process <code>layout.ejs</code> with <code>homepage.ejs</code> to produce the View that&rsquo;s being rendered by my browser.  The <code>Layout.ejs</code> file is actually a wrapper around <code>homepage.ejs</code>.  And what I mean by that is if we look at both files you can see that <code>layout.ejs</code> contains typical mark-up that we want for every page, things like DOCTYPE, html, and head tags.  So we have EJS tags here with a <code>body</code> variable which when processed by the Sails View Engine is replaced with the contents of <code>homepage.ejs</code> .  The result is our View.</p>

<p>Despite it&rsquo;s power, and to make this example crystal clear, I&rsquo;m going to disable the layout functionality in Views at least for the time being.  To do this I&rsquo;ll go into into /config/views.js and change the <code>layout</code> parameter from <code>layout</code> to false.</p>

<p>The first part of activityOverlord v2.0 consists of the <strong>Signup Page</strong> and when completed will look something like this.  Let&rsquo;s get started.  I&rsquo;ll first create a new file named <code>startup.ejs</code> and I&rsquo;ll put a simple header in it <code>&lt;h1&gt; Signup Page&lt;/h1&gt;</code>.  Next, I&rsquo;ll remove the existing <code>route</code> to the <code>homepage</code> and replace it with a <code>route</code> to the new <code>The Signup Page</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s1">&#39;GET /signup&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">view</span><span class="o">:</span> <span class="s1">&#39;signup&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s take a look.  I&rsquo;ll start Sails using <code>sails lift</code> and then navigate my browser to <code>localhost:1337/signup</code>.  Okay good, here&rsquo;s our signup page.</p>

<p>Let&rsquo;s go back to the <code>Signup Page</code> and I&rsquo;ll start by copying in some boilerplate <code>html</code>.  Next, I&rsquo;ll add our first <strong>Angular</strong> <code>directives</code> into the body tag &mdash; <code>ng-app</code>, <code>ng-controller</code>, and <code>ng-cloak</code>. Let&rsquo;s refresh the browser and see what happens.  Well nothing happens, because we haven&rsquo;t yet added Angular yet.  We could manually add the script tags that reference  Angular, however, Sails can do this automatically for us using it&rsquo;s own tagging system (e.g. <code>&lt;!--SCRIPTS--&gt;</code> <em>tag</em>).  You know what, it&rsquo;s easier just to show you.  So I&rsquo;ll add the <em>tags</em> to <code>signup.ejs</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Sign</span> <span class="nx">Up</span> <span class="k">for</span> <span class="nx">Activity</span> <span class="nx">Overlord</span> <span class="p">(</span><span class="nx">angular</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">Viewport</span> <span class="nx">mobile</span> <span class="nx">tag</span> <span class="k">for</span> <span class="nx">sensible</span> <span class="nx">mobile</span> <span class="nx">support</span> <span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">body</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">app</span><span class="o">=</span><span class="s2">&quot;SignupModule&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">&quot;SignupController&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">cloak</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">Signup</span> <span class="nx">Page</span>
</span><span class='line'>    <span class="c">&lt;!--</span><span class="nx">SCRIPTS</span><span class="o">--&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--</span><span class="nx">SCRIPTS</span> <span class="nx">END</span><span class="o">--&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll restart the Sails server using <code>Sails lift</code> and then go back into the browser but also open up the browser console&hellip;okay let&rsquo;s refresh the page and see what happens.  Okay, that new, we get this console message that we&rsquo;re &ldquo;connected to Sails&rdquo;, but where did that come from?  If we look at the page source we&rsquo;ll get a clue.  Towards the bottom of the page a link to a file named<code>sails.io.js</code> has been added to our signup page (e.g. <code>signup.ejs</code>).  But where did that link come from?   Let&rsquo;s go into our project in Sublime and navigate to <code>assets/js</code>.  In the dependencies foler there&rsquo;s our sails.io.js file.  First, this file deals with <code>web sockets</code> and <code>socket.io</code>, which we&rsquo;ll be covering in later episodes.  The big question now is, how did a link to that file get inserted into <code>signup.ejs</code>?  The short answer is that <strong>Grunt</strong> did it for us.  Okay, so what&rsquo;s <code>Grunt</code>?</p>

<p><code>Grunt</code> calls itself a <em>JavaScript Task Runner</em> but really <code>Grunt</code> is all about automation.  It allows you to create repetive tasks that can be executed automatically.  For example, there&rsquo;s a Grunt task that&rsquo;s looking for changes in the Sails assets folder.  Sails creates a .tmp folder in the root of our project.  As we can see here any files in the assets folder are copied into .tmp/public which acts like a static file folder you&rsquo;d find on any web server.  But what about the link to sails.io.js?  This is yet another Grunt Task that will place a link to any javascript file found in assets/js that has the corresponding Script tags we just placed in signup.ejs (e.g. <code>&lt;!--SCRIPTS--&gt;&lt;!--SCRIPTS END--&gt;</code>).</p>

<p>Of course all of these tasks are happening automatically without us having to be aware of them.  However, for those of you who want a little more detail behind the magic,  I created a doc that goes into much more specifics of the Grunt/Sails integration than I do in this screencast.  The documentation can be found <a href="https://github.com/irlnathan/s-grunt-docs/blob/master/overview.md">here</a>.</p>

<p>So let&rsquo;s go ahead and place the main Angular file in the <code>assets/js/dependencies</code> folder and I&rsquo;ll refresh the browser.  Looking at the page source we can see that a link to angular has been automatically placed in our signup page.  But when I refreshed the browser, Angular is mad at us because we have some directives in the signup page without any associated javascript files.  But not to worry, we can easily fix that.  Let&rsquo;s navigate back to the <code>assets/js</code> folder in Sublime and we&rsquo;ll create a folder called <code>public</code>.  We&rsquo;ll put all of our Angular files that have to do with those parts of the application that don&rsquo;t require authentication.  Within <code>public</code> we&rsquo;ll create a folder called <code>signup</code>.  And within <code>signup</code> we&rsquo;ll create two files SignupModule.js<code>and</code>SignupController.js<code>.  Okay, first let's take a look at</code>SignupModule.js` and  I&rsquo;ll add the bare bones Angular code to define our new module.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;SignupModule&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, I&rsquo;ll open <code>SignupController.js</code> and add the bare bones Angular code to define our new controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;SignupModule&#39;</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SignupController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go back to the browser and refresh the page.  As you can see, we still have an Angular issue.  If we look at the page source, we can see what the issue is, <code>SignupController</code> is getting loaded before <code>SignupModule</code>.  This is easy to fix and touches on another aspect of <strong>Grunt</strong>.  Most of the configuration for Grunt can be found within the <code>activityOverlord20/tasks</code> folder.  For this issue we&rsquo;re going to look in the root of the <code>tasks</code> folder for a file named <code>pipeline.js</code>.  This file contains the configuration for how the SCRIPTS tags are used (e.g. <code>&lt;!--SCRIPTS--&gt;</code>)  as well as some other tags we&rsquo;ll be using shortly.</p>

<p>Next, I&rsquo;ll open <code>pipeline.js</code> in Sublime.  We want to load the <code>SignupModule</code> after dependencies but before any other javascript files.  So we&rsquo;ll put the path to our file here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Dependencies like jQuery, or Angular are brought in here</span>
</span><span class='line'>  <span class="s1">&#39;js/dependencies/**/*.js&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// All of the rest of your client-side js files</span>
</span><span class='line'>  <span class="c1">// will be injected here in no particular order.</span>
</span><span class='line'>  <span class="s1">&#39;js/public/signup/SignupModule.js&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;js/**/*.js&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now when I refresh the browser, Angular no longer complains and if look back at the page source we can see that SignUpModule is being loaded before SignupController.</p>

<p>So let&rsquo;s go back to signup.ejs in Sublime and insert the remainder of the markup for our Signup Page.   Let&rsquo;s start-up Sails using <code>Sails lift</code> and navigate the browser to localhost:1337/signup.  Although the page loads without errors, there&rsquo;s some obvious dependencies that need to be added in order for this page to look right.  First I&rsquo;ll add Bootstrap (e.g. <code>bootstrap.css</code>) to the <code>/assets/sytles</code> folder.  Similar to what we did with javascript files in the previous episode, Sails will automatically include links to the CSS in <code>signup.ejs</code>.  Taking a look at <code>signup.ejs</code> we can see the Styles tags that were added when I brought in the earlier mark-up as well as a link Grunt automatically created to the bootstrap file I just added.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>...
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--SCRIPTS--&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--SCRIPTS END--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, I&rsquo;m going to create a <code>fonts</code> folder and add some fonts we&rsquo;ll be using later in the interface.</p>

<p>I&rsquo;m also going to add some <code>.less</code> files into the <code>assets/styles</code> folder that we&rsquo;ll being using later in the interface as well.</p>

<p>You may have noticed the <code>importer.less</code> file which let&rsquo;s us control which less files are included the Styles Tag as well as their order.  Note that the Grunt task included in Sails will only compile the <code>.less</code> files that are referenced in this file.</p>

<p>I&rsquo;m also be adding Jesús Rodríguez&rsquo;s <a href="https://github.com/Foxandxss">https://github.com/Foxandxss</a> fantastic angular messaging library Angular-toastr.  The library contains both a javascript and a css file.</p>

<p>Finally, I&rsquo;ll add the <code>CompareTo</code> Angular Directive which will help us with comparing the value of form fields.  I&rsquo;ll place it in the <code>/js/dependencies</code> folder.</p>

<p>So let&rsquo;s see where we are after these dependencies were added.  I&rsquo;ll head back to the browser refresh the page.  The console displays an <code>Uncaught reference error that Angular is not defined.</code>  Since this is coming from the <code>toastr</code> library my hunch is that we have a loading order error. And sure enough if we look at the page source, the <code>toaster</code> library is being loaded before Angular.   I&rsquo;ll head back to our project and <code>pipeline.js</code> in sublime and add a reference to Angular here (e.g. <code>'js/dependencies/angular.1.3.js',</code>) that will load Angular first before any of the other depedencies.</p>

<p>Let&rsquo;s head back to the browser and refresh the page.   Great, there&rsquo;s no longer and error.</p>

<p>Now let&rsquo;s take a look at some form validation in signup.ejs.  There are three components to the form field validation we&rsquo;re going to perform.  So taking a look at the name field.  We first use the ng-class directive to create the <code>has-error</code> class if the field name is invalid and dirty.  This will insert a red border around the input field.  Next we&rsquo;ll configure the validation parameters of the field itself.  In this case we&rsquo;re requiring that the field have a value as well as have a maxlength of 50 characters.  Finally, we&rsquo;ll set-up the text for our error message here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- Also, if signup.name.$dirty is true, show the message depending upon the particular properties truthiness (e.g. required</span>
</span><span class='line'><span class="c">and/or maxlength) --&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.name.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.name.$error.required&quot;</span><span class="nt">&gt;</span>Name is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.name.$error.maxlength&quot;</span><span class="nt">&gt;</span>The name cannot be more than 50 characters.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see this in action.  I&rsquo;ll go back to the browser and type in a name.  Now If I remove the name, the required validation is triggered and if I add to many character&rsquo;s the maxlength validation will be triggered.</p>

<p>Let&rsquo;s go back to signup.ejs and review the remaining form fields configuration.</p>

<p>So the Title field&rsquo;s configuration is identical to the name, the title is required and has a max length of 50 characters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- T I T L E --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-12&quot;</span>
</span><span class='line'>  <span class="na">ng-class=</span><span class="s">&quot;{&#39;has-error&#39;:signup.title.$invalid &amp;&amp;</span>
</span><span class='line'><span class="s">                        signup.title.$dirty}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Your title<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;e.g. Genius&quot;</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.title&quot;</span> <span class="na">ng-maxlength=</span><span class="s">&quot;50&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.title.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.title.$error.required&quot;</span><span class="nt">&gt;</span>Title is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.title.$error.maxlength&quot;</span><span class="nt">&gt;</span>The name cannot be more than 50 characters.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Email field is required and requires a properly formatted email address.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- E M A I L --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-12&quot;</span>
</span><span class='line'><span class="na">ng-class=</span><span class="s">&quot;{&#39;has-error&#39;:signup.email.$invalid &amp;&amp;</span>
</span><span class='line'><span class="s">                      signup.email.$dirty}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Your email address<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;email&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;nikola@tesla.com&quot;</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.email&quot;</span> <span class="na">required</span> <span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.email.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.email.$error.required&quot;</span><span class="nt">&gt;</span>Email address is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.email.$error.email&quot;</span><span class="nt">&gt;</span>Not a valid email address.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Password field is required and must be at least 6 characters.  Also notice that we&rsquo;re using the CompareTo directive to compare the password field with the confirmPassword model.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- P A S S W O R D --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-6&quot;</span>
</span><span class='line'><span class="na">ng-class=</span><span class="s">&quot;{&#39;has-error&#39;:signup.password.$invalid &amp;&amp;</span>
</span><span class='line'><span class="s">                      signup.password.$dirty}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Choose a password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- Added the compareTo directive that compares the passowrds --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;at least 6 characters&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">required</span> <span class="na">ng-minlength=</span><span class="s">&quot;6&quot;</span> <span class="na">compare-to=</span><span class="s">&quot;signupForm.confirmPassword&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.password.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.password.$error.required&quot;</span><span class="nt">&gt;</span>Password is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.password.$error.minlength&quot;</span><span class="nt">&gt;</span>Password must be at least 6 characters.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Password Confirmation field is required and must match the Password Field.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- C O N F I R M  P A S S W O R D --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-6&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Re-enter your password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;one more time&quot;</span> <span class="na">name=</span><span class="s">&quot;confirmation&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.confirmPassword&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.confirmation.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.password.$error.compareTo&quot;</span><span class="nt">&gt;</span>Password must match.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.confirmation.$error.required&quot;</span><span class="nt">&gt;</span>Confirmation password is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we disable the form submission button via the <code>ng-diabled</code> directive until all of the form fields have valid values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- C O N F I R M  P A S S W O R D --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- Disable signup button until the form has no errors --&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary btn-lg btn-block&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">ng-disabled=</span><span class="s">&quot;signup.$invalid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;!signupForm.loading&quot;</span><span class="nt">&gt;</span>Create Account<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;overlord-loading-spinner fa fa-spinner&quot;</span> <span class="na">ng-show=</span><span class="s">&quot;signupForm.loading&quot;</span> <span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signupForm.loading&quot;</span><span class="nt">&gt;</span>Preparing your new account...<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Okay let&rsquo;s go back and take a look at the validations in action.  I&rsquo;m going to refresh the browser.</p>

<p>Believe it or not that rounds out our signup page.  In the next episode we&rsquo;ll start to flesh out our initial API that connects the signup page with an endpoint that creates a user account via a model into a database.</p>

<p>You can find all of the source code for this episode at the activityOverlord20 repo on github.</p>

<p>And If have a moment plese follow me on twitter and be sure to signup for the Sailscasts mailing list so I can finally prove to my wife that there are actually folks watching this stuff.  As always thanks for watching.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/01/09/setting-up-the-development-environment-and-creating-your-the-project/">Setting Up the Development Environment and Creating Your First Project</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-09T18:21:00-06:00" pubdate data-updated="true">Jan 9<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/01/09/setting-up-the-development-environment-and-creating-your-the-project/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/01/09/setting-up-the-development-environment-and-creating-your-the-project/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/mGrKLi54Xsg" frameborder="0" allowfullscreen></iframe>


<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<h1>Transcript</h1>

<p>Howdy and welcome back.</p>

<p>As in the previous series, I&rsquo;m going to assume you already have Node installed.  If you don&rsquo;t there&rsquo;s a bunch of helpful documentation on <a href="http://nodejs.org">nodejs.org</a> and installers for both Mac OS X and Microsoft Windows can be found <a href="http://nodejs.org/download/">here</a> as well as binaries for Linux and SunOS.</p>

<p>As for as my development enviornment, I&rsquo;m using OS X v10.10.1 also known as Yosemite.  For my text editor I&rsquo;m using Sublime Text 2 which can be found <a href="http://www.sublimetext.com/2">here</a>.  There&rsquo;s also an update to the editor, version 3, which I&rsquo;m not currently using but can be found <a href="http://www.sublimetext.com/3">here</a>.  Another tool we&rsquo;ll be using is the quite awesome chrome extension, known as &ndash; POSTMAN which can be found <a href="https://chrome.google.com/webstore/detail/postman-rest-client/fdmmgilgnpjigdojojpjoooidkmcomcm?hl=en">here</a>.</p>

<p>And last but certainly not least I&rsquo;ll be using Sails v0.11.0.  Now, you may see me running some release candidates of Sails initially, however, because the release of Sails v0.11.0 is eminent, I&rsquo;m not going to bother with how to install a release candidate and these initial screencasts are really not effected by the currently published version of v0.10.5.  Okay let&rsquo;s get Sails up and running by heading over to the terminal window.</p>

<p>From the last series, I received comments from a bunch of folks who had a real aversion to the terminal window.  For those of you who are new to back-end programming, jumping into the terminal window might seem intimidating.  Let me start by saying if I can understand it, believe me you can understand it.  By the end of this series you&rsquo;ll wonder how you got through your day without multiple visits to the terminal.   For those of you on OS X you&rsquo;ll find the terminal application is somewhat hidden in <code>/Applications/Utilities/Terminal.app</code>.  One other potential point of confusion about the terminal is how it&rsquo;s referred to.  For example you&rsquo;ll hear terminal window, prompt, command-line, shell, etc.  For what it&rsquo;s worth here is my attempt at terminology superimposed on this thing I&rsquo;ll be calling the terminal.</p>

<p>With that said, let&rsquo;s jump in.</p>

<p>To install sails, you simply type <code>npm install sails -g</code>, where the -g stands for global.  Note, that because of the way ownership rights are set up on my machine, I have to use <code>sudo</code> or super duper user, actually according to wikipedia it means <code>substitute user do</code>&hellip;.something like that.  Regardless, it allows you to temporarily issue a command as a super or root user.  After that Sails will start installing, so see ya in second.</p>

<p>So, in the last series of building activity overlord some people were confused about the distinction between installing sails globally and where Sails is installed when creating a new project.  By installing Sails globally, we can have access to command-line tools from anywhere on the command-line.</p>

<p>For example, let&rsquo;s create the initial Sails project for activityOverlord v2.0.  From the terminal I&rsquo;ll type <code>sails new activityoverlord20</code>.</p>

<p>So what just happened?  Sails used the globally installed version of itself to generate all of the necessary initial structure for our application.  This includes installing a copy of Sails itself inside the root of our application.  That way, sails applications are completely self contained&hellip;there&rsquo;s no &ldquo;other software&rdquo; outside of our project that we&rsquo;re dependent upon.</p>

<p>Throughout these screencasts there will be times that I want to address specific changes that effect the previous activityoverlord screencasts with v0.11.0 of Sails.  So if you don&rsquo;t have previous experience or interest with older versions of Sails, now is the time to pick up that musical instrument or check some texts for the next few seconds.  When I created the new Sails project you may have noticed that I didn&rsquo;t use the <code>--linker</code> prarameter.  That&rsquo;s because there&rsquo;s no longer a requirement to use it.  By default, that functionality is built into every Sails project.</p>

<p>Now, let&rsquo;s go back to the terminal and move into the new project by typing <code>cd acitivtyoverlord20</code>.  Without changing any of the initial files or folders of the app I can start our newly created web server by typing <code>sails lift</code> and Sails confirms that it is indeed up and running.  Next, I&rsquo;ll open a browser at localhost:1337.  The browser is accessing the default home page Sails generated when we initially built the project.</p>

<p>It&rsquo;s important to take a moment here and realize what we&rsquo;ve just accomplished.  In just a few commands we&rsquo;ve built the initial infrastructure of a web application which includes the creation of its own web server.  We then have a browser, known as the client that is making a request for a previously generated home page through the Sails web server.  The Sails server then response with the home page to be rendered in the browser.</p>

<p>Some of you may be confused by the address <code>localhost:1337</code>.  Typically, when you browse the web you&rsquo;ll enter a domain name like <code>google.com</code>&hellip;and that name actually resolves to an some ip address which maps to some computer out on the internt.  Alright, <code>localhost</code> is default name for what is technically termed a <code>loopback address</code>.  My machine&rsquo;s <code>localhost</code> points to the address <code>127.0.0.1</code>.  What the <code>loopback address</code> allows allows us to do is bypass the outside network and address a specific web service on our local machine.  In our case that web service is the Sails server.  So when the Sails starts or lifts, by default, it&rsquo;s given a port number of <code>1337</code>.  As we&rsquo;ll see in a second we can change the <code>port number</code> if we want.  <code>Port numbers</code> are the way in which we can differentiate one web service from another.  For example, I currently have our activityoverlord20 project running on port <code>1337</code>.  I created another Sails project called <code>foo</code> that I&rsquo;m going to lift on port <code>1338</code>.  When I go into the browser and open the address <code>localhost:1338</code> the homepage that I altered comes up for the foo project.  So the combination of localhost and the port number allows us to run both the server and client on the same machine while we&rsquo;re building the project.  To get completely geeky, and show you that localhost is really an arbitrary, there&rsquo;s a file found on my mac at <code>~/etc/host</code> that specifies what &ldquo;points&rdquo; to <code>127.0.0.1</code>.   As you can see, in addition to localhost I have the name <code>yaya</code> also pointing to 127.0.0.1 and yes we can go into the browser and type yaya:1337 and our homepage comes up.</p>

<p>Okay, I think I&rsquo;ve beat that one to a pulp&hellip;but sometimes you know I just get carried away.  In the next episode we&rsquo;ll start building up the client ui of activityOverlord v2.0.  So, see ya&rsquo;ll in a bit.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/01/01/lets-start-a-new-adventure/">Let&#8217;s Start a New Adventure</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-01T12:24:00-06:00" pubdate data-updated="true">Jan 1<span>st</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/01/01/lets-start-a-new-adventure/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/01/01/lets-start-a-new-adventure/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/EHIybLmoxfE" frameborder="0" allowfullscreen></iframe>


<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<h1>Transcript</h1>

<p>Howdy all&hellip;Happy New Year, and welcome.</p>

<p>Well for those of you who have listened to the previous activityOverlord screencasts the good news is I am armed with Keynote v6.5, which is filled with even more cheesey animations for me to abuse, the bad news is I&rsquo;m even older than I was in the last series of screencasts. Seriously though I think I can overcome that and take you on another programming journey, this time updating Activity Overlord to v2.0.  Now what&rsquo;s in v2.0? The major updates include using a bunch of new features in v0.11 of Sails as well as updating the front-end UI to use AngularJS.</p>

<p>The current plan is to get the the original activityOverlord videos up to date ASAP.  Time permitting I&rsquo;ll continue making screencasts that take deeper dives into various concepts addressed in building the app.  The videos will be hosted on youtube under the ponzicoder channel with transcripts available at the following <a href="http://irlnathan.github.io/sailscasts/">gihub page</a>.  The source code is hosted in a repo on github <a href="github.com/irlnathan/activityoverlord20">here</a>. If you like what you see and want to make an old guy happy, please follow me on twitter <a href="https://twitter.com/irlnathan">here</a> and as important subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<p>If you find bugs feel free to send a pull request to this github repo &mdash; <a href="http://github.com/irlnathan/activityoverlord20.">http://github.com/irlnathan/activityoverlord20.</a>  If what I just said makes absolutely no sense, I&rsquo;ll be covering git and github in future screencasts.  If you have questions, there are a variety of forums to ask them.  The Sails irc channel, Stackoverflow using the tag sailsjs, and the Sails google group are all active.</p>

<p>Needless to say I&rsquo;m really excited about this new series&hellip;and as always thanks for watching.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2014/01/17/sailscasts-answers-ep8-how-do-blueprint-actions-and-blueprint-routes-work-in-sails/">sailsCasts Answers: Ep8 - How Do Blueprint: Actions and Blueprint: Routes Work in Sails?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-17T17:43:00-06:00" pubdate data-updated="true">Jan 17<span>th</span>, 2014</time>
        
           | <a href="/sailscasts/blog/2014/01/17/sailscasts-answers-ep8-how-do-blueprint-actions-and-blueprint-routes-work-in-sails/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2014/01/17/sailscasts-answers-ep8-how-do-blueprint-actions-and-blueprint-routes-work-in-sails/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/EnKRrdTi_gk" frameborder="0" allowfullscreen></iframe>


<p>The repo for this episode can be found here: <a href="https://github.com/irlnathan/sails-crud-api-sailsAnswers8">https://github.com/irlnathan/sails-crud-api-sailsAnswers8</a></p>

<h1>Transcript</h1>

<p>Howdy and welcome back.  You&rsquo;re watching the third and final installment of our three part series.  In part one we learned how the http request/response protocol works with routes, controllers, actions and models to deliver a restful json CRUD api.  In part two we took those concepts and built the api from scratch.</p>

<p>In this episode we&rsquo;ll explore Sails <strong>blueprint: actions and routes</strong>, a powerful combination of functionality that are often used but not always fully understood.  The goal of this episode is to show you what the blueprints are all about and how to use them to make your programming life a bit easier. So where are we going to start?</p>

<p>First a small warning here. This episode relies heavily on the previous two screencasts, so if you start to experience dizziness, tightness in the chest, or depression, I highly recommend you review those screencasts.</p>

<p>Let&rsquo;s take a look at the roadmap of what we&rsquo;ll be covering in this episode.</p>

<p>There are four pre-built <em>blueprint: actions</em> (e.g. <code>find</code>, <code>create</code>, <code>update</code> and <code>destroy</code>).  As we&rsquo;ll see in a minute, these four actions  map directly to the CRUD api we buit in the last episode.  There are also three blueprint: route types, blueprint: actions routes, blueprint: rest routes, and blueprint: shortcuts routes.</p>

<p>I want to make one thing very clear from the beginning.  Blueprint: actions and blueprint: routes are virtualized in the sense that they are not explicitedly defined in controller files like SleepController.js or the routes.js file.  Instead, they&rsquo;re  built-up when sails starts using <code>sails lift</code>.  But as usual I&rsquo;m getting ahead of myself.</p>

<p>Let&rsquo;s start with seeing what happens when we combine  blueprint: actions and blueprint: rest routes.</p>

<p>So in the last episode I went over in excrutiating detail, how to make a restful json CRUD api.  The goal of api was to track our sleep patterns, specifically how much we sleep each night and the quality of that sleep.  The best way to show you how blueprints help you automate the creation of an api is to repeat the process of building the restful json CRUD api, however, add the power of blueprints.</p>

<p>Let&rsquo;s jump in here and create a new mySleep project.  I&rsquo;m in the terminal and will create the project using <code>sails new mySleep --linker</code> with the linker flag.  Next, I&rsquo;ll change into the mySleep folder and create a <code>sleep</code> model and controller using <code>sails generate sleep</code>.  Finally, I&rsquo;ll start the project using <code>sails lift</code>.  Okay, we&rsquo;re done, the api is complete.</p>

<p>But you DON&rsquo;T believe me? After all we&rsquo;ve been through.  Well I guess I&rsquo;ll have to prove it to you.</p>

<p>Seriously though, everything we did in the last episode was just built with those three commands.</p>

<p>I&rsquo;ll open a browser and once again using the POSTMAN chrome extension I&rsquo;ll make similar requests that we made in the last episode that relate to a CRUD api…</p>

<p><strong>Let&rsquo;s start with the Create portion of CRUD.</strong> I&rsquo;ll add an instance to the sleep model using the http verb <code>POST</code> to the path <code>/sleep</code> adding two parameters <code>hours_slept</code> and <code>sleep_quality</code>.  After sending the request the api returns our newly created record as json.  In fact, I&rsquo;ll make four more model instances inserting different values for <code>hours_slept</code> and <code>sleep_quality</code>.</p>

<p><strong>Next we&rsquo;ll try the Read portion of CRUD.</strong> Let&rsquo;s get all of the model instances by making a <code>GET</code> request to the path <code>/sleep</code>. After sending the request the api returned all five instances of the model:</p>

<p>Next, let&rsquo;s make a <code>GET</code> request to the path <code>/sleep/2</code>.  The api returns a single instance of the model with an <code>id</code> of 2:</p>

<p>Now let&rsquo;s try a request with some criteria.  We&rsquo;ll look for any model instances with an <code>id</code> not equal to 4, limited to 3 model instances and in descending order.</p>

<p>After making the request, the api returns three instances of the model in descending order.</p>

<p>Things are looking up for my assertion that our api was indeed complete.</p>

<p><strong>Next up, we&rsquo;ll try the Update portion of CRUD api.</strong> I&rsquo;m going to make a <code>put</code> request to the path:</p>

<p><code>http://localhost:1337/sleep/3?added_attrib=12</code></p>

<p>After making the request, the api returns our instance of the model that has an id of <code>3</code> with our added attrib formatted as json.</p>

<p><strong>Finally, we&rsquo;ll try the Delete portion of our CRUD api.</strong> Once again within the POSTMAN chrome extension I&rsquo;ll make a delete request to the path:</p>

<p><code>destroy</code> <code>http://localhost:1337/sleep/5</code></p>

<p>After sending the request the api responds with the model instance it just deleted formatted as json.</p>

<p>Let&rsquo;s take a quick check of the controller we created in <code>controllers/SleepController.js</code>. Yep, nothing in it.  Next let&rsquo;s look at the <code>config/routes.js</code> file.  Pretty much the same, nothing in there except the <code>home</code> route.</p>

<p>So at this point your probably wondering how in the heck are we able to use the same restful api end points that we used in the last episode BUT without any explicit actions are routes?</p>

<p>Is it mind control?</p>

<p>The really short answer is that we&rsquo;re using blueprint: actions and blueprint: rest routes to automate the process of building the api. The next question is, how do they work?</p>

<p>When sails initially starts using sails lift, sails looks to see if you have any controller&rsquo;s defined.  In our example, we have one controller, the Sleep controller.  Sails then provides access to blueprint: actions for this sleep controller as if we built them in the controller ourselves.  Sails also automatically creates blueprint: rest routes that are identical to the routes we explicitedly created in the last episode.  When combined together, the blueprint: actions  and blueprint: rest routes, give us the exact functionality we had in our manually created json restful CRUD api without having to create anything other than a project,  an empty controller, and an empty model.</p>

<p>So where are the blueprint: actions actually defined? Okay, nerd alert here, and when I say nerd alert, I&rsquo;m starting with myself, you can see what the actions look like by taking a look at the sails source <a href="https://github.com/balderdashy/sails/tree/master/lib/hooks/controllers">here</a> on github.   Looking at these actions they look very similar to the ones we created in the last episode.  The difference is that sails handles all of this in the background, creating the necessary blueprint: rest routes that connect the actions to our controllers automatically.  Again, this is all happening in memory without you having to explicitedly create anything.</p>

<p>Also, remember, that the mySleep project we&rsquo;ve been working through uses a single controller.  The blueprint: actions and blueprint: rest routes are not limited to a single controller so for a more complex project, with multiple controllers, sails blueprints: rest routes are built automatically for all of the controllers.</p>

<p>You can of course override any of the actions by explicitedly creating one of the actions in your controller.  For example, I&rsquo;ll go back to the SleepController, and create a find action that simply responds with &ldquo;I&rsquo;m your new explicit find action&rdquo; upon request.  Let&rsquo;s restart the server and go back into the browser.  I can still use the <code>create</code>, <code>update</code>, and <code>delete</code> actions, however, now when I make a <code>get</code> request to the path /sleep, I now receive our message .</p>

<p>So with sails you get the blueprint: actions and the blueprint: rest routes but wait there&rsquo;s more!  Sorry, couldn&rsquo;t resist that.  In addition, sails also provides blueprint: action routes, not to be confused with blueprint: actions.</p>

<p>blueprint: action routes speed up backend development and shorten the development workflow by eliminating the need to manually bind custom controller actions to requests through routes.</p>

<p>So when sails starts via sails lift, sails analyzes your controllers and if it finds an explicit action in a controller, it will bind <code>GET</code>, <code>POST</code>, <code>PUT</code>, and <code>DELETE</code> routes to the explicit action.  For example, in our sleep project, I&rsquo;ve added the action <code>query</code> to the sleep controller.  So when sails starts, using <code>sails lift</code>, sails will automatically build the following blueprint: actions routes:</p>

<ul>
<li><code>'get /sleep/query/:id?: UserController.query'</code></li>
<li><code>'post /sleep/query/:id?: UserController.query</code></li>
<li><code>'put /sleep/query/:id?: UserController.query</code></li>
<li><code>'delete /sleep/query:id?: UserController.query'</code></li>
</ul>


<p>Let&rsquo;s see it in action.  I&rsquo;ll open a browser and make a  <code>get</code> request to the path <code>/sleep/query</code>.  The <code>query</code> action responds with a view that can be found in views/sleep/query.ejs.</p>

<p>The important take-away here is that when I created a new action, in this case, the <code>query</code> action, I didn&rsquo;t have to create a route to bind a request to that action.  By using blueprint: actions routes sails did this for me automatically.</p>

<p>So let&rsquo;s go back to our blueprint: roadmap.  So far we&rsquo;ve covered blueprint: CRUD actions as well as blueprint: rest routes and blueprint: actions routes.  The final blueprint: route type is blueprint: shortcuts.</p>

<p>blueprint: shortcuts build routes that allow you to use the blueprint: actions from a browser.  I use blueprint: shortcuts during development as a handy way to manipulate my underlying model.</p>

<p>The best way to see how this works is through an example.</p>

<p>I can grab a list of all my model instances using the url <code>/sleep</code>.  I can create a new model instance using the url &lsquo;/sleep/create&rsquo; and adding the parameters sleep_quality and hours_slept.  I can also update that same instance using the url <code>/sleep/update</code> with the <code>id</code> of <code>8</code> and changing hours_slept from <code>10</code> to <code>9</code>.  Finally, I&rsquo;ll delete the model instance by using the url <code>/sleep/destroy/6</code>.</p>

<p>One bit of caution.  blueprint: shortcuts were not designed to be used in production.  So how do we disable parts of the blueprints?</p>

<p> The <code>blueprint: routes</code> and <code>blueprint: actions</code> are completely configurable.  That is, they can be disabled simply by setting the values of actions, rest, and/or shortcuts to <code>false</code> in the <code>\config\controllers.js</code> file.  You can have even finer granularity by setting the same values in  the <code>_config</code> object within each controller which will override what is in <code>\config\controllers.js</code> file.</p>

<p>Okay, we have a bunch of routes here, but how do they all fit together.  So all of these different routes have an order of precedence or rank.  When a request comes in sails first checks the explicit routes in routes.js.  Next it will look to see if there&rsquo;s a match in the blueprint: actions routes, followed by the blueprint: rest routes and finally, sails will see if there&rsquo;s a match in the blueprint: shortcuts routes.</p>

<p>So if there&rsquo;s a <code>get</code> request to the root route, sails will route it via <code>routes.js</code> to render <code>views/home/index.ejs</code>.</p>

<p>If there&rsquo;s a <code>get</code> request to <code>/sleep/query</code>, sails, finding no match in <code>routes.js</code>, will look to the blueprint: action routes and finding a match will route the request to the explicit <code>query</code> action of the Sleep Controller.</p>

<p>If there&rsquo;s a <code>delete</code> request to <code>/sleep/5</code>, sails, finding no match in <code>routes.js</code> or blueprint: action routes, will look to the blueprint: rest routes and finding a match will route the request to the blueprint: destroy action, returning a json object if successful.</p>

<p>Finally, if there&rsquo;s a reqest to <code>get</code> <code>/sleep/update/2</code> with some params, sails, finding no match in <code>routes.js</code>, blueprint: action nor rest routes, will look to the blueprint: shortcut routes and finding a match will route the request to the blueprint: CRUD update action, passing any params to the model&rsquo;s <code>update</code> method returning a json object if successful.</p>

<p>In this series we&rsquo;ve learned the concepts of how to use the http request/response protocol with routes, controllers, actions and models to deliver a restful json CRUD api.  Using those concepts we&rsquo;ve built the api from scratch.  Hopefully, after this episode it becomes apparent that blueprint: actions and routes are really about automation.   That is, eliminating the necessity of writing, at least initially, repetitive actions and routes during development.</p>

<p>We&rsquo;ve covered a lot of material and I hope you&rsquo;ve found it helpful.  As always thanks for watching and if you get a chance follow me on twitter at irlnathan.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2014/01/14/sailscasts-answers-ep7-how-do-i-create-a-restful-json-crud-api-in-sails-from-scratch/">sailsCasts Answers: Ep7: How Do I Create a Restful Json CRUD Api in Sails From Scratch?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-14T14:40:00-06:00" pubdate data-updated="true">Jan 14<span>th</span>, 2014</time>
        
           | <a href="/sailscasts/blog/2014/01/14/sailscasts-answers-ep7-how-do-i-create-a-restful-json-crud-api-in-sails-from-scratch/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2014/01/14/sailscasts-answers-ep7-how-do-i-create-a-restful-json-crud-api-in-sails-from-scratch/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/Hr8axUV6NpM" frameborder="0" allowfullscreen></iframe>


<p>The repo for this project can be found here: <a href="https://github.com/irlnathan/sails-crud-api">https://github.com/irlnathan/sails-crud-api</a></p>

<h1>Transcript</h1>

<p>Howdy and welcome back to part II of our three part series.  In the last episode we learned how the http request/response protocol works with routes, controllers, actions and models to deliver a restful json CRUD api.  In this episode we&rsquo;ll take the concepts we learned and use them to build the api from scratch. In the final episode we&rsquo;ll explore how sail&rsquo;s <em>blueprints: actions and routes</em> can be used to create that same restful json CRUD api automatically for any of your controllers and models.</p>

<p>Let&rsquo;s review what we&rsquo;re trying to accomplish.</p>

<p>Our api will be used to access and update information that tracks our sleep patterns including how much we sleep each night and the quality of that sleep.</p>

<p>So we want the api to be able to respond to requests to find, create, update or delete instances of our sleep model.  We&rsquo;ll create actions that corresond to the requests and then build up routes that match the appropriate http verbs and paths with the corresponding controller and action.</p>

<ul>
<li>So the <strong>find</strong> request will use the http verb <code>get</code> with the path <code>/sleep/:id?</code> and bind to the <code>sleep</code> controller and <code>find</code> action.</li>
<li>The <strong>create</strong> request will use the  verb <code>post</code> with the path <code>/sleep</code> and bind to the <code>sleep</code> controller and the <code>create</code> action.</li>
<li>The <strong>update</strong> request will use the verb <code>put</code> with the path <code>/sleep/:id?</code> and bind to the <code>sleep</code> controller and the <code>update</code> action.</li>
<li>and finally, the <strong>delete</strong> request will use the  verb <code>delete</code> with the path <code>/sleep/:id?</code> and bind to the <code>sleep</code> controller and <code>destroy</code> action.</li>
</ul>


<p>The actions will then use the model methods to find, create, update or destroy the model as requested and use the parameters <code>hours_slept</code> and <code>sleep_quality</code> to pass any necessary information within the request through the action to the model.  The action will then respond with the request status as well as any model instance or instances required.</p>

<p>So let&rsquo;s get started.  I&rsquo;m going to bring up a terminal window and we&rsquo;re going to create a new sails project called <code>mySleep</code> using <code>sails new mySleep --linker</code>.  and I&rsquo;ll change into the <code>mySleep</code> folder and generate a sleep controller and model using <code>sails generate sleep</code>.</p>

<p>So, here&rsquo;s a roadmap of what we&rsquo;re going to build.  I&rsquo;m going to start with the create action, building the action and then building the route that will bind the find request with the sleep controller and find action. I&rsquo;m going to go through each action, create it, and then build the matching route that will bind our request to the controller and action.   So let&rsquo;s start with the create action.</p>

<p>I&rsquo;ll open my sleep controller found in <code>/api/controllers/SleepController.js</code> and create my first action called <code>create</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// a CREATE action  </span>
</span><span class='line'><span class="nx">create</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">all</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Sleep</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">sleep</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">sleep</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The action is straightforward, we&rsquo;re going to grab the request&rsquo;s parameters in the var <code>params</code> and then pass <code>params</code>  into the <code>create</code> method of our <code>sleep</code> model.  If there&rsquo;s an error we&rsquo;ll return it and if not I&rsquo;ll send a 201 status code response with the newly created model instance formatted as json.</p>

<p>So that&rsquo;s the <code>create</code> action, now I need to create a route that will bind this controller and action to our request.  So let&rsquo;s open the routes in <code>/config/routes.js</code> and I&rsquo;ll add my route after the existing home route:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">routes</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="s1">&#39;/&#39;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">view</span><span class="o">:</span> <span class="s1">&#39;home/index&#39;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Custom CRUD Rest Routes</span>
</span><span class='line'>  <span class="s1">&#39;post /sleep&#39;</span><span class="o">:</span> <span class="s1">&#39;SleepController.create&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>The route consists of the verb <code>post</code> to the path <code>/sleep</code> which is bound to the <code>sleep</code> controller and the <code>create</code> action.  So let&rsquo;s make sure our create action is working.  I&rsquo;ll go into the terminal, start sails with <code>sails lift</code>.  I&rsquo;ll again be using the POSTMAN chrome extension to test our requests.  We&rsquo;ll be using the http verb <code>POST</code> to the path <code>/sleep</code> adding two parameters <code>hours_slept</code> and <code>sleep_quality</code>.  When I click send, Sails returns my newly created record as json.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-12-10T21:31:00.442Z&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-12-10T21:31:00.442Z&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So let&rsquo;s take a look at our api roadmap.  We&rsquo;ve built the create action as the first of the four actions of our api.  Next, we&rsquo;ll build the <code>find</code> action and then we&rsquo;ll build a route that will bind Sleep controller and find action to our request.  For the action let&rsquo;s go back into the <code>SleepController.js</code> file and look at the find action code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>   <span class="c1">// a FIND action</span>
</span><span class='line'><span class="nx">find</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">idShortCut</span> <span class="o">=</span> <span class="nx">isShortcut</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">idShortCut</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">Sleep</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">sleep</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">sleep</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">notFound</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">sleep</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">where</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">where</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">where</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">where</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// This allows you to put something like id=2 to work.</span>
</span><span class='line'>      <span class="c1">// if (!where) {</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//     // Build monolithic parameter object</span>
</span><span class='line'>   <span class="c1">//    params = req.params.all();</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">//    params = _.omit(params, function (param, key) {</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">//        return key === &#39;limit&#39; || key === &#39;skip&#39; || key === &#39;sort&#39;</span>
</span><span class='line'>
</span><span class='line'>   <span class="c1">//    });</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//   where = params;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">//   console.log(&quot;making it here!&quot;);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// }</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nx">limit</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">skip</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;skip&#39;</span><span class="p">)</span>  <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">sort</span><span class="o">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;sort&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
</span><span class='line'>                  <span class="nx">where</span><span class="o">:</span> <span class="nx">where</span> <span class="o">||</span> <span class="kc">undefined</span>
</span><span class='line'>          <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;This is the options&quot;</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</span><span class='line'>              
</span><span class='line'>      <span class="nx">Sleep</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">sleep</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nx">sleep</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">notFound</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">sleep</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">isShortcut</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;find&#39;</span>   <span class="o">||</span>  <span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;update&#39;</span> <span class="o">||</span>  <span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;create&#39;</span> <span class="o">||</span>  <span class="nx">id</span> <span class="o">===</span> <span class="s1">&#39;destroy&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Let&rsquo;s also take a look at the route that will bind our request to the sleep controller and <code>find</code> action in <code>/config/routes.js</code>:</p>

<p><code>'get /sleep/:id?': 'SleepController.find'</code></p>

<p>The route points to our <code>find</code> action but look the end of the path, what&rsquo;s up with <code>:id?</code>, and the question mark?  The question mark makes the <code>id</code> parameter optional.  That way we capture both the request <code>'get /sleep'</code> as well as <code>'get /sleep/:id'</code>.</p>

<p>The find action will be our most complex action of the four in our api.  This is because we have to provide for a request finding a single instance of the model, multiple instances of the model, as well as using criteria and options to narrow and/or limit the scope of the find request.</p>

<p>So within our find action, we&rsquo;ll attempt to assign a parameter called <code>id</code> to the var <code>id</code>.  The next line of code looks to see if the <code>id</code> is a shortcut.  I&rsquo;m going to skip over this part because shortcuts are part of sail&rsquo;s blueprints which we&rsquo;ll be discussing in the third episode.</p>

<p>So if the <code>id</code> exists we&rsquo;re going to assume that the request is looking for a particular model instance. We&rsquo;ll pass the <code>id</code> to the <code>findOne</code> model method and if we don&rsquo;t get back an instance of <code>sleep</code> in the callback, we&rsquo;ll return or respond with a status code of <code>404</code>&mdash; <code>not found</code>.  On success, we&rsquo;ll return and respond with the model instance formatted as json.</p>

<p><strong>Checking for multiple model instances.</strong> If no <code>id</code> is provided we&rsquo;ll start looking for other criteria or options that may have been passed as a parameter for finding one or more model instances.  Criteria is placed in a <code>where</code> clause which is just the key name for a criteria object.  For example, if your want to find all model instances where sleep_quality = good, your parameters would look like this: <code>?where={sleep_quality: "good"}</code>.  We&rsquo;ll also check for options that further limit the result in some way. For example, let&rsquo;s say we only want the first 5 model instances of our result.  The parameters would look like this: <code>?where={sleep_quality: "good"}&amp;limit=5</code>.</p>

<p>So if <code>where</code> exists as a parameter and the value for it is a string, we&rsquo;ll just parse it as json and assign it to the var <code>where</code>.  Even if <code>where</code> doesn&rsquo;t exist we&rsquo;ll still look for the keys <code>limit</code>, <code>skip</code>, and <code>sort</code> and place them within the options object. Finally, we&rsquo;ll pass the options object to the Find model method and if we don&rsquo;t get back an instance of <code>sleep</code> in the callback, we&rsquo;ll return or respond with a status code of <code>404</code>&mdash; <code>not found</code>.  On success, we&rsquo;ll return and respond with the model instance(s) formatted as json.</p>

<p>So we have the find action complete, let&rsquo;s make sure all of this works.  I&rsquo;ll head back to the terminal and restart the sails server using <code>sails lift</code> and then open a browser with the POSTMAN chrome extension. I&rsquo;ve added a few more instances of our sleep model.  Let&rsquo;s take a look by sending a <code>get</code> request to the path <code>/sleep</code>.  After sending the request the api returned five instances of the model:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;8&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-09T23:36:01.552Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-09T23:36:01.552Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;great&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:08:52.398Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:08:52.399Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">2</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;poor&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:10.319Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:10.319Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;6&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;so-so&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:20.456Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:20.456Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">4</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:30.885Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:30.885Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">5</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Since we didn&rsquo;t provide an <code>id</code> or any criteria or options, the api used the find model method and returned all instances of the model formatted as json.</p>

<p>Next, let&rsquo;s make a <code>get</code> request to the path <code>/sleep/2</code>.  After pressing send, the api returns a single instance of the model with an <code>id</code> of 2:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;great&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:08:52.398Z&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:08:52.399Z&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">2</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s try a request with some criteria.  We&rsquo;ll look for any model instances with an <code>id</code> greater than 1:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">localhost</span><span class="o">:</span><span class="mi">1337</span><span class="o">/</span><span class="nx">sleep</span><span class="o">?</span><span class="nx">where</span><span class="o">=</span><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;&gt;&quot;</span><span class="o">:</span>  <span class="mi">1</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After making the request, the api returns four of the five model instances with <code>id</code>&rsquo;s greater than 1.</p>

<p>Finally, I&rsquo;m going to combine the criteria with some options. I&rsquo;m going to make a <code>get</code> request to the path <code>/sleep</code> for  model instances with an <code>id</code> not equal to 4, limited to 3 model instances and in descending order.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">localhost</span><span class="o">:</span><span class="mi">1337</span><span class="o">/</span><span class="nx">sleep</span><span class="o">?</span><span class="nx">where</span><span class="o">=</span><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;!&quot;</span><span class="o">:</span>  <span class="mi">4</span><span class="p">}</span>
</span><span class='line'><span class="p">}</span><span class="o">&amp;</span><span class="nx">limit</span><span class="o">=</span><span class="mi">3</span><span class="o">&amp;</span><span class="nx">sort</span><span class="o">=</span><span class="nx">id</span> <span class="nx">desc</span>
</span></code></pre></td></tr></table></div></figure>


<p>After making the request, the api returns three instances of the model in descending order.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">[</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:30.885Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:30.885Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">5</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;poor&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:10.319Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:09:10.319Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;hours_slept&quot;</span><span class="o">:</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;sleep_quality&quot;</span><span class="o">:</span> <span class="s2">&quot;great&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;createdAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:08:52.398Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;updatedAt&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-01-11T05:08:52.399Z&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">2</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we know that our <code>find</code> action is battle tested, let&rsquo;s go back to our api roadmap.  By building the create action and route and the find action and route we&rsquo;re half way through our api.  Next, we&rsquo;ll build the <code>update</code> action and then we&rsquo;ll build a route that will bind the Sleep controller and update action to our request.  Let&rsquo;s head back into the <code>SleepController.js</code> file and look at the update action code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// an UPDATE action</span>
</span><span class='line'>    <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">criteria</span> <span class="o">=</span> <span class="p">{};</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">criteria</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">merge</span><span class="p">({},</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">all</span><span class="p">(),</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">badRequest</span><span class="p">(</span><span class="s1">&#39;No id provided.&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">Sleep</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">criteria</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">sleep</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span><span class="p">(</span><span class="nx">sleep</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">notFound</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">sleep</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>The update action consists of finding the <code>id</code> of the model instance to update coupled with the criteria that will be updated.  If there&rsquo;s no <code>id</code> as a parameter we respond with a 400 status&mdash; &lsquo;No id provided&rsquo;.  Next we attempt to update the model instance using the <code>id</code> and criteria provided. If there&rsquo;s an error we&rsquo;ll return it and if not respond with the updated model instance formatted as json.</p>

<p>So now that we have the update action complete, we&rsquo;ll bind that action to the request forming a new update route:</p>

<p><code>'put /sleep/:id?': 'SleepController.update'</code></p>

<p>The route points to our <code>update</code> action and uses the same <code>:id?</code> pattern that we used in the <code>find</code> route.</p>

<p>Let&rsquo;s make sure all of this works.  I&rsquo;ll restart the sails server using <code>sails lift</code> and then open a browser with the POSTMAN chrome extension. I&rsquo;m going to first make a <code>put</code> request to the path:</p>

<p><code>http://localhost:1337/sleep/3?added_attrib=12</code></p>

<p>After making the request, the api returns our instance of the model that has an id of <code>3</code> with our added attrib formatted as json.</p>

<p>Next, I&rsquo;ll make a <code>put</code> request to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:1337/sleep/3</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;added_3&quot;</span><span class="o">:</span> <span class="mi">42</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>…but instead of using query parameters, I&rsquo;ll pass the update via the request body.  After making the request, the api returns our instance of the model that has an id of <code>3</code> with our added_3 attribute formatted as json.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'>  <span class="c1">// Custom Action Route</span>
</span><span class='line'>  <span class="s1">&#39;get /sleep/new&#39;</span><span class="o">:</span> <span class="s1">&#39;SleepController.new&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Custom CRUD Rest Routes</span>
</span><span class='line'>  <span class="s1">&#39;get /sleep/:id?&#39;</span><span class="o">:</span> <span class="s1">&#39;SleepController.find&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;post /sleep&#39;</span><span class="o">:</span> <span class="s1">&#39;SleepController.create&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;put /sleep/:id?&#39;</span><span class="o">:</span> <span class="s1">&#39;SleepController.update&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;delete /sleep/:id?&#39;</span><span class="o">:</span> <span class="s1">&#39;SleepController.destroy&#39;</span><span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that update action and route is complete it&rsquo;s time to build the last action of our api the <code>destroy</code> action and then bind it to our request to form the <code>delete</code> route.  Let&rsquo;s head back into the <code>SleepController.js</code> file and look at the destroy action code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// a DESTROY action</span>
</span><span class='line'>    <span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">param</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">badRequest</span><span class="p">(</span><span class="s1">&#39;No id provided.&#39;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="nx">Sleep</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span><span class="nx">id</span><span class="p">).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">serverError</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">result</span><span class="p">)</span> <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">notFound</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>            <span class="nx">Sleep</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">next</span> <span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">},</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we&rsquo;ll attempt to assign the <code>id</code> param to a var called <code>id</code>.  If it doesn&rsquo;t exist I&rsquo;ll return a 400&mdash; &lsquo;No id provided&rsquo;. If an <code>id</code> parameter was provided in the request, I&rsquo;ll attempt to find it in the <code>sleep</code> model.  If the model doesn&rsquo;t exist I&rsquo;ll  respond with a status code of <code>404</code>&mdash; <code>not found</code>.   If the mode instance does exist, I&rsquo;ll pass the <code>id</code>  to the destroy method of the model returning either an error if any, or the deleted model instance formatted as json.</p>

<p>Next I&rsquo;ll bind the destroy action with the request in its own <code>delete</code> route:</p>

<p><code>'delete /sleep/:id?': 'SleepController.destroy'</code></p>

<p>Let&rsquo;s check it out by restarting the sails server using <code>sails lift</code>. Once again within the POSTMAN chrome extension I&rsquo;ll make a delete request to the path:</p>

<p><code>destroy</code> <code>http://localhost:1337/sleep/5</code></p>

<p>After sending the request the api responds with the model instance it just deleted formatted as json.</p>

<p>Congratulations, you&rsquo;ve built a restful json CRUD api.  Any client-side device that supports http requests can now hit our api&rsquo;s endpoints and request and submit information about our sleep model.</p>

<p>In the next and final episode of this series I&rsquo;ll show you how sail&rsquo;s <em>blueprints: actions and routes</em> can be used to create this same restful json CRUD api we just created, automatically for any of your controllers and models.</p>

<p> Okay that was a lengthy one, As always, thanks  for watching and if you get a chance, follow me on twitter @irlnathan.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/sailscasts/blog/page/2/">&larr; Older</a>
    
    <a href="/sailscasts/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/">Building an Angular Application in Sails: Ep3 - Understanding Asset Delivery Options in Our SignUp Page.</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2015/01/09/setting-up-the-development-environment-and-creating-your-the-project/">Setting Up the Development Environment and Creating Your First Project</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2015/01/01/lets-start-a-new-adventure/">Let&#8217;s Start a New Adventure</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2014/01/17/sailscasts-answers-ep8-how-do-blueprint-actions-and-blueprint-routes-work-in-sails/">sailsCasts Answers: Ep8 - How Do Blueprint: Actions and Blueprint: Routes Work in Sails?</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2014/01/14/sailscasts-answers-ep7-how-do-i-create-a-restful-json-crud-api-in-sails-from-scratch/">sailsCasts Answers: Ep7: How Do I Create a Restful Json CRUD Api in Sails From Scratch?</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - irl nathan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sailscasts';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
