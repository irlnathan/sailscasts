
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>sailsCasts</title>
  <meta name="author" content="irl nathan">

  
  <meta name="description" content="Signup for the Treeline Beta here. Follow me on twitter here. Subscribe to the sailscasts mailing list here. Transcript Howdy. In the last episode &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://irlnathan.github.io/sailscasts">
  <link href="/sailscasts/favicon.png" rel="icon">
  <link href="/sailscasts/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/sailscasts/atom.xml" rel="alternate" title="sailsCasts" type="application/atom+xml">
  <script src="/sailscasts/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/sailscasts/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43421644-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/sailscasts/">sailsCasts</a></h1>
  
    <h2>Learning about sails.js one screencast at a time.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/sailscasts/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:irlnathan.github.io/sailscasts" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/sailscasts/">Blog</a></li>
  <li><a href="/sailscasts/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/04/04/building-an-angular-application-in-sails-ep6-user-authentication-in-angular-and-sails/">Building an Angular Application in Sails: Ep6 - User Authentication in Angular and Sails.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-04-04T13:39:00-05:00" pubdate data-updated="true">Apr 4<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/04/04/building-an-angular-application-in-sails-ep6-user-authentication-in-angular-and-sails/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/04/04/building-an-angular-application-in-sails-ep6-user-authentication-in-angular-and-sails/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/IqpjIQ0pfkA" frameborder="0" allowfullscreen></iframe>


<h3>Signup for the Treeline Beta <a href="http://treeline.io">here</a>.</h3>

<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<h1>Transcript</h1>

<p>Howdy.</p>

<p>In the last episode we finished out the signup page.  We now want to take that information and allow users to login, better known as user authentication.  So far we&rsquo;ve created one Angular module for the signup page connected to our Sails API. And this is under a broader category of public pages or those pages that don&rsquo;t require a user to be logged in to see them.  We also need a homepage that will also be public.  Finally we need a view, I&rsquo;m going to call the dashboard that will require that the user be logged in to our back-end.</p>

<p>So we have three Angular modules for activityOverlordv2.0.  You can of course accomplish the same end result in a variety of different ways, but I&rsquo;ve chosen this approach for simplicity and ease of SEO.</p>

<p>Ok, let&rsquo;s start with the homepage.</p>

<p>We&rsquo;ll first replace the current mark-up in homepage.ejs within the view folder with this new mark-up.  The markup contains our top level navigation, which includes the sign in button that triggers a <code>PUT</code> request to <code>/login</code>,  as well as a sign-up button that triggers a <code>GET</code> request to <code>/signup</code>. I realize I&rsquo;m going through this pretty fast but don&rsquo;t despair, I have a repo that has all of the code for your review.</p>

<p>Let&rsquo;s look at the Angular module and controller for the homepage.   The homepage and signup module&rsquo;s are identical both inject the toastr and compareTo services.  The homepage controller adds a new method to the scope called <code>submitLoginForm</code>.  Similar to signup form, <code>submitLoginForm</code> initially sets the loading state to <code>true</code>.  We then make a <code>PUT</code> request to <code>/login</code> passing in an <code>email</code> field as well as a <code>password</code> field from the $scope object.  If the request is successful, we&rsquo;ll make the equivalent of the a <code>GET</code> request to <code>/</code>.  If we&rsquo;re unsuccessful we&rsquo;ll handle the known errors, in this case a bad email/password combination through the <code>toastr</code> service and return.  We&rsquo;ll also handle any unexpected error here.  Finally, in either case we&rsquo;re toggle the <code>loginForm</code> loading state back to false.</p>

<p>So now that we have the front-end set up for the <code>Homepage</code>, let&rsquo;s switch gears to the back-end Sails API.</p>

<p>The first thing I want to do is handle the <code>PUT</code> request to <code>/login</code>.   So I&rsquo;ll add that <code>route</code> to the <code>routes.js</code> file here. We want this to trigger a <code>login</code> action in our <code>UserControlller</code>.  Next, we&rsquo;ll head over to our user controller in <code>UserController.js</code>.  So let&rsquo;s add the add the <code>login</code> action.  The next block of code I&rsquo;ll add first takes the email address that was passed from the login form and searches our <code>user</code> model for an existing user. If it doesn&rsquo;t find one we&rsquo;ll send back a <code>404</code> status which will trigger the <code>toastr</code> message in the HomePageController.  Next, we&rsquo;ll be using another machinepack, called machinepack-passwords.  Within the machinepack we&rsquo;ll use the <code>checkPassword</code> machine passing in the user provided password from the login form as well as the encrypted password found by the <code>findOne</code> method of our <code>user</code> model.  Within this <code>machine</code> we handle any unexpected error first and then if the <code>passwords</code> don&rsquo;t match we again send a <code>404 status</code> via <code>res.notFound()</code>.  For reference, these responses can be found in the responses folder here.  If we get a match, we need to log the user in so we&rsquo;ll create a new parameter on the session via <code>req.session.me</code> and give it the value of the <code>id</code> of the user we found earlier with <code>findOne</code> method of the <code>user</code> model.  The last thing we need to do is let the front-end know everything went well and we do that by returning with <code>res.ok()</code>.</p>

<p>Let&rsquo;s see all of this in action.  I&rsquo;ll start Sails with <code>sails lift</code> and we&rsquo;ve got an issue here.  I know what it is because I&rsquo;m old and forgetful. So, I&rsquo;m going to go into the <code>routes.js</code> file and you&rsquo;ll see that I just missed a comma here. So let&rsquo;s go back and try that again. Okay, Sails is up and running, let&rsquo;s go to the browser and let&rsquo;s hit <code>localhost:1337</code>. Okay, so the reason we&rsquo;re getting a <code>404</code> not found is we don&rsquo;t have a route that handles a <code>GET</code> request to <code>/</code>. Now we could remedy this very quickly by going back to the <code>routes.js</code> file, and we&rsquo;ll create a route here, that handles a <code>GET</code> request to <code>/</code>, which will trigger the homepage and we&rsquo;ll restart Sails here&hellip;go back into the browser and refresh and ther&rsquo;s our homepage and that&rsquo;s great.  But what I really want is a way to marshall between whether a user is authenticated, that is, logged in, and if they&rsquo;re logged in I want to display one front end and if they&rsquo;re not logged in a different front end. I can do that by adding a page controller to Sails.  So let&rsquo;s do that. First, I&rsquo;ll add the controller via <code>sails generate controller page</code>. Now let&rsquo;s go back into Atom and we have our <code>PageController</code> here which is empty.  I&rsquo;m going to add an action here <code>showHomePage</code>.</p>

<p>We first check if the user is logged in via the <code>me</code> parameter on the session, so, if <code>req.session.me</code> does not exist, I want to load the homepage and I&rsquo;m going to do that by return <code>res.view('homepage')</code>. Otherwise if the user is logged in, I&rsquo;m going to use the <code>findOne</code> method of the <code>user</code> model to look for that user. So I&rsquo;ll pass in the <code>userId</code> which is the value of the <code>me</code> parameter on the session. First I&rsquo;ll look for an unexpected error here and I&rsquo;ll handle that with <code>res.negotiate</code> if it exists. If I don&rsquo;t find a user, I&rsquo;m going to return the user to the homepage. Now if I do find a user, I&rsquo;m going to return a view that we haven&rsquo;t created yet called <code>dashboard</code>. I&rsquo;m going to bootstrap some information that I found via the <code>findOne</code> method of the user model on the page itself.</p>

<p>Before we create the dashboard view you may be asking what&rsquo;s going to trigger this <code>showHomePage</code> action. Well, we&rsquo;re going to do that by going into, <code>routes.js</code> and substituting this current view with our <code>PageController</code> and our <code>PageController</code> action <code>showHomePage</code>. So now any time there&rsquo;s a <code>GET</code> request to <code>/</code> our page controller will marshall which front end the user receives.</p>

<p>Now let&rsquo;s implement our dashboard page.  The mark-up for the dashboard page is straightforward.  As with the signup and homepage views, the dashboard view will have some top level navigation.  The part I want to concentrate on is the bootstrapped data we get from the page controller&rsquo;s <code>showHomePage</code> action.  So using <code>ejs</code> we&rsquo;ll add the parameters of the <code>me</code> object from the <code>showHOmePage</code> action on to <code>window.SAILS_LOCALS</code>.</p>

<p>Next, let&rsquo;s add the very minimal dashboard module and controller. I&rsquo;ve added these files under a separate folder named <code>private</code> to distinguish between the Angular code that will be executed when a user is authenticated and code that is public and does not require authentication.</p>

<p>I want to ensure that the new Angular modules I&rsquo;ve added will be loaded before any controllers, so I&rsquo;ll go back to <code>pipeline.js</code> found in the <code>tasks</code> folder and add the path to the two new modules &mdash; <code>HomepageModule</code> and `DashboardModule&#8217;.  This will insure that the modules will be loaded into the page first.</p>

<p>Okay, let&rsquo;s see this all in action. So I&rsquo;ll start Sails, with <code>sails lift</code>, and then navigate my browser to <code>localhost:1337</code>.  In the previous episode we created an account, <code>nikola@tesla.com</code> with the password <code>123456</code> and I&rsquo;m going to use that now.  Now if you don&rsquo;t have that user created, no big deal, just click on the sign up now button and create that user, <code>nikola@tesla.com</code> with the password <code>123456</code>, then go back to <code>localhost:1337</code> and start from there&hellip;and we have our dashboard page. And if we view the page source, we can see that we have our bootstrap user right here on the page.  So let&rsquo;s go back to the <code>PageController</code> really quickly here&hellip;<code>req.session.me</code> existed, we used that with the <code>findOne</code> method of the <code>user</code> model&hellip;it found the user and then passed the user object via the <code>me</code> parameter and bootstrapped it onto the dashboard page.</p>

<p>So there are a couple of things we still need to implement here. We have this sign-out link, that if i click on it it&rsquo;s going to give us a <code>404</code> and that&rsquo;s because we don&rsquo;t have a route that handles that link&hellip;so this link is making a <code>GET</code> request to <code>/logout</code> and we don&rsquo;t have a route for that so let&rsquo;s take care of that first.  So now that <code>GET</code> request to <code>/logout</code> will be tied to or will trigger the <code>UserController</code> and this new action on the controller. So let&rsquo;s go up to <code>UserController</code> and let&rsquo;s add a <code>logout</code> action.</p>

<p>So similar to our login action we&rsquo;re going to look for the user id on <code>req.session.me</code>&hellip;we&rsquo;re going to pass that to the <code>findOne</code> method of our <code>user</code> model&hellip;we&rsquo;re going to handle the errors if they exist and if it finds a user, we&rsquo;re going to essentially log that user out by making <code>req.session.me</code> equal to <code>null</code>. Then we&rsquo;re going to return with a new response, <code>backToHomePage()</code>. So let&rsquo;s take a look at that response.</p>

<p>So this response is basically for convenience&hellip;if logout were an AJAX request, Sails will know that that request just wants a JSON status code response. In our case we&rsquo;re making a <code>GET</code> request via the browser, so we just want to redirect back to <code>/</code> and let our page controller handle it.  Okay let&rsquo;s see this in action.</p>

<p>So I&rsquo;ll go and restart Sails, and we&rsquo;ll go back and log-in.  So now when I hit the signout link the <code>PageController</code> sends me back to the homepage.</p>

<p>There&rsquo;s just a couple of other things we need to do. Within the <code>UserController</code>, <code>signup</code> action we want the user to be logged in after they&rsquo;re signed up. So we&rsquo;ll do that right here. And within the signup page controller, on a successful signup we made a <code>GET</code> request via the browser to <code>/user</code> and now we just want to ake that <code>/</code>.</p>

<p>Let&rsquo;s go ahead and restart one more time. And we&rsquo;ll now go to signup, and I&rsquo;ll create a new user <code>b</code>, <code>b@b.com</code>&hellip;and everything works.  So the user was created and logged-in&hellip;and let&rsquo;s take a look at the page source&hellip;and there we are there&rsquo;s our bootstrapped data.</p>

<p>Thanks for making it through the many voices of Sailscasts.  Although it might seem that there are different Irl&rsquo;s on this Sailscast, I assure you that it was the same ole guy throughout&hellip;al beit Allergy-challenged.  So now we know how to create a user, save it to a database using the Sails ORM, and then use that information to authenticate a user marshalling between different Angular front-ends depending upon the user&rsquo;s log-in status.</p>

<p>There&rsquo;s been quite a bit going on in Sails and Treeline so expect an update shortly via the Sailscasts mailing list.  If you&rsquo;re not signed up, head over here to subscribe and you can always follow me on Twitter here.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/03/10/building-an-angular-application-in-treeline-sneak-peak-implementing-the-signup-page-in-treeline/">Building an Angular Application in Treeline Sneak Peak: Implementing the Signup Page in Treeline.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-10T11:48:00-05:00" pubdate data-updated="true">Mar 10<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/03/10/building-an-angular-application-in-treeline-sneak-peak-implementing-the-signup-page-in-treeline/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/03/10/building-an-angular-application-in-treeline-sneak-peak-implementing-the-signup-page-in-treeline/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/KH5E2TL-_e8" frameborder="0" allowfullscreen></iframe>


<h3>Signup for the Treeline Beta <a href="http://treeline.io">here</a>.</h3>

<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<h1>Transcript</h1>

<p>Howdy.</p>

<p>So, I wanted to do a quick screencast previewing a new project from the Sails crew called Treeline.  So, let&rsquo;s get busy.</p>

<p>In the last two episodes we implemented the <code>/signup</code> request via Sails blueprints and then a custom controller action.  Today, I want to show you how I would do this in Treeline.  So I have a Treeline project here, which should look very similar to a Sails project because that&rsquo;s what it is with some very powerful additions.  I&rsquo;ve copied the assets folder from our existing activityOverlord20 project to the assets folder here.  So we have the same front-end asset structure, but I&rsquo;m going to create the back-end api in treeline.</p>

<p>So here I am in the Main Treeline Dashboard. We&rsquo;ll go to apps, we&rsquo;ll create a new app, and not surprisingly we&rsquo;ll call it activityoverlord20.  And the first thing we&rsquo;re going to do is create our model.  Now, in the past episode we created a user mode.  We&rsquo;ll add attributes to that model the first being name and notice that I&rsquo;m going to add an example, and treeline will infer which type is appropriate.   Next, I&rsquo;ll add the other attributes title, email, password, and gravatar url.</p>

<p>So now that we have our user model let&rsquo;s define the two routes that our front end requires.  The first route will be GET /signup.  This takes us into the circuit view.  Since we just want to display our signup.ejs view we can specify that in an empty circuit here. Okay, next I&rsquo;ll create the route to POST /signup.  As you may recall we first wanted to take the password from our form and encrypt it.  We used node-machines to do that.  You can think of treeline as the visual interface for node-machines.  So I&rsquo;ll just drag the encrypt password machine as a part that will fit on something called a circuit.  And then I&rsquo;ll access the password field from our signup page via a route paramter.</p>

<p>Next we want to convert an email address into a gravatar url.   I&rsquo;ll search for the gravatar machinepack and install it.  And from with that machinepack I&rsquo;ll get the getImageUrl machine and put it on our circuit as well. Now similar to what we did with the encrypt password, I need to get our email address from our form and I&rsquo;ll do that with a route parameter.</p>

<p>At this point we wanted to make sure that we had unique email addresses and if we didn&rsquo;t to let the front in know via a 409 status code.  So I&rsquo;ll drag a findone user machine over to our circuit and look up the email address provided by our form in the user model.  If a record is found, we know the email address is taken and we want to let the front end know so I&rsquo;ll respond with a 409 status.  If a record is not found, we want to go ahead and create the user so I&rsquo;ll drag a create user machine over and start connecting the user model with our form fields.  We&rsquo;ll do this mainly through route parameters, so for the name we&rsquo;ll get the route parameter, for the password we&rsquo;re going to actually get the output of our encrypt password machine.  For the email we&rsquo;ll go ahead and use a route parameter, we&rsquo;ll do the same for the title field, and finally for the gravatar url we&rsquo;ll use the output of the gravatar machine.</p>

<p>Okay let&rsquo;s see all of this in action.  So we&rsquo;ve built the api in Treeline and Treeline syncs the controller and model with our local project when I lift it using Treeline preview. So let&rsquo;s head to our browser and navigate to localhost:1337/signup which will make the GET request to <code>/signup</code> and our signup view.  Next, let&rsquo;s go ahead and create a User record &ndash; Nikola Tesla.</p>

<p>Let&rsquo;s go back to the signup page and create Nikola Tesla again and see if our duplicate email message is triggered.</p>

<p>And there it is&hellip;so this really just scratches the surface of the power of treeline.  In addition to the activityoverlord20 screencasts I plan to do additional videos on this new tool.  If you&rsquo;re interested in using treeline, head over to treeline.io and sign up for the beta.  As always thanks for watching.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-creating-custom-actions-and-an-intro-to-node-machines/">Building an Angular Application in Sails: Ep5 - Creating Custom Actions and an Intro to Node-machines.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-06T17:04:00-06:00" pubdate data-updated="true">Mar 6<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-creating-custom-actions-and-an-intro-to-node-machines/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-creating-custom-actions-and-an-intro-to-node-machines/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/jaGpf7t5y0Q" frameborder="0" allowfullscreen></iframe>


<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<p>The repo for this episode can be found <a href="https://github.com/irlnathan/activityoverlord20">here</a>.</p>

<h1>Transcript</h1>

<p>In the last episode we implemented a request to <code>/signup</code> using a Sails blueprint action.  The default blueprint create action is fine but I really don&rsquo;t want to save passwords in clear text and I also want to generate a gravatar for each user.  Let&rsquo;s overwrite the blueprint create action with our own signup action. This will also let me introduce a new concept to the Sails community &mdash; node machines.</p>

<p>So let&rsquo;s head back to the editor and open up the UserController.js file.   I&rsquo;m going to create an empty signup action here:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">signup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">ok</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, let&rsquo;s navigate your browser to node-machine.org which is kind of the mothership of node-machine information.  The first thing to understand is that machines are built on the existing and very powerful node module framework.  Second, the node-machine specification and the machines located at nodemachine.org are completely open source and MIT licensed.  Third, machines are packaged up in something called a machinepack that can be required just like any other node module from npm.  So, I&rsquo;ll show you how to create node-machines in future screencasts, for now, we&rsquo;ll be consumers of a couple of them.</p>

<p>I know I want to encrypt passwords so let&rsquo;s browse the existing machinepacks.  So here&rsquo;s one called passwords.  And there&rsquo;s a machine called encryptPassword that looks kind of interesting.  With machines you know exactly what inputs you can use and exactly what you&rsquo;ll get out from the exits.  I&rsquo;m just going to copy the example usage here and paste it into my signup action.  I&rsquo;ll also move my existing response to the success exit of the machine.</p>

<p>I&rsquo;m also going to move our response into the success exit.  Finally, I&rsquo;ll grab the password as an input to the machine from a request parameter and if there&rsquo;s an error I&rsquo;ll let Sails handle it with res,negotiate and respond with the error.  I&rsquo;m also going to change the default result arguent to a more meaningful name like encrypted password.</p>

<p>So in addition to encrypting the password I want to create a gravatar url from the email address that we get from our user.  Let&rsquo;s go back to node-machine.org and browse to the gravatar machinepack.  The getImageUrl machine returns a URL of a gravatar based upon an inputted email address.   This machine actually has two ways we can set it up.  The example usage is using `execSync()<code>, which allows me to use the machine sychronously.  I want to use the machine asynchronously so I'll use</code>.exec()&#8220;.  Therefore, I&rsquo;ll also provide both success and error handlers.</p>

<p>So we&rsquo;ve encrypted our passwords and generated a gravatar URL.  Next we&rsquo;ll save these attributes along with the other fields in our signup form using the create method of our user model.  I&rsquo;ve also added an attribute lastLoggedIn and assigned it the value of the date method.  If we get an error I&rsquo;ll let Sails handle it with res,negotiate and respond with the error.  Otherwise I&rsquo;ll return a response with the id of the new user record as json.</p>

<p>We need to install the two machines we&rsquo;re using.  Open up the terminal window and type npm install machinepack-passwords -save.  Next, we&rsquo;ll install the gravatar machinepack by typing <code>npm install machinepack-gravatar -save</code>.</p>

<p>Okay, let&rsquo;s make sure all of this works.  Restart Sails using sails lift.  Again we&rsquo;re going to get this message about migration.  Our choices are:  Safe, Drop, and Alter</p>

<p>If I set migrations to <code>safe</code>,  sails doesn&rsquo;t do anything other than create a connection to the database and run queries. It&rsquo;s the default environment for production and should be used whenever you are working with data you don&rsquo;t want to risk losing.</p>

<p>Instead of trying to migrate the data in the database this mode drops the database and creates brand new tables, essentially giving you a fresh start.  If you have a bootstrap file that resets your data on every lift then the drop migration is a good way to get going when your models are constantly changing in the beginning of a project.</p>

<p><code>alter</code> is next step up from <code>drop</code>.  The difference is that before it drops the database it tries to store all the records in memory and when the table has been re-created it attempts to re-insert them into the new data structure. It&rsquo;s useful if you have a very small data set and are making trivial changes to the data schema.  We&rsquo;ll ultimately be using safe mode but for now we&rsquo;ll use alter.  We can set this mode by going into the config/models.js file and uncommenting this line.</p>

<p>So let&rsquo;s lift sails using sails lift.  Navigate your browser to <code>localhost:1337/signup</code>.  I&rsquo;ll add another one of my heros Neil Armstrong.  And as you can see we have a new record with an encrypted password, a gravatar URL and our lastLoggedIn Attribute.</p>

<p>So far we&rsquo;ve been using our user model without any attributes.  And that&rsquo;s fine, especially for nosql databases.  In this current project, we&rsquo;re using Sails local disk database that has characteristics of a no-sql database.  We&rsquo;ll be swapping it out for mongo in an upcoming episode.  At this point, I want to prevent duplicate users and I also want to prevent the storage of fields other than those I define in my model.  This is just a double check because we&rsquo;re specifying the fields we want to create in our controller action.  So we&rsquo;re currently in the user model via the /models/User.js file.  I&rsquo;m going to add some attributes here.  We&rsquo;re already doing a bunch of validation client side, but since those are not necessarily secure, we&rsquo;ll reinforce the validation on the back-end.  I&rsquo;ll use the required attribute on some of the fields and the unique attribute on the email field.  This will prevent duplicate email addresses from being saved.</p>

<p>So let&rsquo;s go back to our signup action in the user controller.  First I want to parse the error I get back from Sails regarding the duplicate email address.  Let&rsquo;s log the error and take a look at what we get back.  So in POSTMAN with Sails lifted.  I&rsquo;ll create the Nikola Tesla record.  Now when I try to add Tesla again, I get the unique error.  So let&rsquo;s go back into the action and handle that error.  This also let&rsquo;s me introduce you to custom responses.  So if an error exists and it has to do with the email attribute, and the rule that&rsquo;s being violated is the unique attribute, then I want to respond with this emailAddressInUse function.  I&rsquo;m going to place that function as a custom response in the responses folder.  Let&rsquo;s go ahead and take a look that resonse.  So, I&rsquo;ll get access to the response and then return a more easily parsable object back to the client.  So let&rsquo;s re-lift  Sails and in POSTMAN try to add Mr. Tesla again and we get our error object.</p>

<p>Let&rsquo;s provide for a better user experience to this error on the front end.  First we&rsquo;ll go into the SignUp Module and inject the toastr service we started in the last episode.  This will provide us with some great looking messages.  Next, we&rsquo;ll do something similar in the SignupController injecting the toastr service into our controller.  So now we need handle the duplicate error response from Sails passing an error message to the user.  In the last episode we already set this up in the markup of our signup page.  So start Sails and navigate your browser to <code>localhost:1337/signup</code>.  I&rsquo;ll attempt to create Nikola Tesla one more time.  And there&rsquo;s our duplicate user error message, however, the loading state hasn&rsquo;t changed as evidenced by the animated Create Account button.  Okay the reason for this is something most refer to as old age.  But the good news it&rsquo;s an easy fix. So, head back to SignupController and change signupForm.location: false to  signupForm.loading: false which is what actually was intended but for you know what.  Just to show you it&rsquo;s fixed I&rsquo;ll add Nikola again for the last time.  And we get both the message and the button with the correct loading state.</p>

<p>Alright, in the next episode we&rsquo;ll add our login state through a request to /login, our profile page, and a database switch to mongodb.  Thanks as always for watching and be sure to follow me on twitter and signup for the Sailscasts mailing list.  Also go checkout and signup for the beta of the Sails team&rsquo;s latest creation Treeline.io.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-ep4-implementing-requests-in-angular-to-a-sails-api/">Building an Angular Application in Sails: Ep4 - Implementing Requests in Angular to a Sails API.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-06T17:03:00-06:00" pubdate data-updated="true">Mar 6<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-ep4-implementing-requests-in-angular-to-a-sails-api/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-ep4-implementing-requests-in-angular-to-a-sails-api/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/eOZ7n-5uASo" frameborder="0" allowfullscreen></iframe>


<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<p>The repo for this episode can be found <a href="https://github.com/irlnathan/activityoverlord20">here</a>.</p>

<h1>Transcript</h1>

<p>Howdy from Austin and welcome back.</p>

<p>It&rsquo;s now time to get into implementing our Sails back-end api for the signup page.  In terms of workflow, we&rsquo;re going to let the signup page drive the requirements of our Sails <em>back-end</em>.  So looking at the signup page I want to find all of the places where the frontend needs to make requests of our backend.</p>

<p>Not to get too nerdy here, but really we&rsquo;ve already made a <code>request</code> from our browser to our Sails back-end when we loaded the signup page.  When I navigated to <code>localhost:1337/signup</code> with the browser, the Sails web server passed our request to the router, which parsed the request, in this case, /signup and matched it with a handler in the routes.js file ultimately responding with this view.  So now that we have the signup page rendered in our browser, what other elements in the page need to make requests?</p>

<p>There are at least three different elements that will make requests to the Sails back end api.  They include <code>/</code> when the user clicks the activityOverlord2.0 logo, to <code>/login</code> when the user clicks the Sign In button, and to <code>/signup</code> when the user clicks the Create Account button.  I&rsquo;m going to implement the request to <code>/signup</code> first.  Now, some of you might be wondering, wait, we&rsquo;ve already handled a request to <code>/signup</code>.  And that&rsquo;s true but it&rsquo;s to GET /signup, where GET is the HTTP verb that the browser tpically uses to request web pages.  This new request, however, will use the HTTP verb POST as in POST <code>/signup</code>.  If this is starting to make your head spin, get your balance and head over to this episode which explains HTTP routing in nauseating detail.  Actually I, I hope it isn&rsquo;t nauseating.</p>

<p>Ok,  this POST <code>/signup</code> request will take the gathered contents of this form and send it to the Sails server via an AJAX request from Angular.</p>

<p>So let&rsquo;s set this up and go b  ack in our text editor, wait where&rsquo;s sublime.  I love sublime text but I wanted to experiment with the Atom editor from github for the next serveral episodes&hellip;.anyway we&rsquo;re in signup.ejs.  And we need to implement this function that the ng-submit directive is pointing to: `submitSignupForm()&#8220;.  But where do we declare that function?  We&rsquo;ll declare it in our controller which we pointed to via the ng-controller directive here.  The actual controller code is contained in a file named SignupController.js by convention because really we could&rsquo;ve named the fie foo.  So here&rsquo;s where we actually created the controller.  So I&rsquo;ll declare the function here.  But this function has no connection or binding to the markup.  We&rsquo;ll use the Angular $scope object to make this connection.  Angular characterizes the $scope object as the glue between the controller and directives in the markup.  So on the onehand we have controllers contained in javascript files and on the other we have directives contained in mark-up.  And the $scope object is used as the bridge between them.</p>

<p>So let&rsquo;s fire up sails using Sails lift and go into the chrome browser and navigate to <code>localhost:1337/signup</code>.  And as you can see here we&rsquo;ve got an error&hellip;our $scope object has not defined.  What&rsquo;s happened is the $scope has not been injected into our function.  But we can easily remedy that by passing the scope as an argument into the function.  Now when we refresh the browser, we no longer have an issue.  But we&rsquo;re not out of the woods yet.</p>

<p>Angular determines a controller&rsquo;s dependencies from the arguments to the controller&rsquo;s constructor function.  So if we minify our JavaScript for the Signup controller, all of the function arguments including $scope would be minified as well.  So $scope could turn into the letter a and Angular&rsquo;s dependency injector would not be able to identify services correctly.  But there&rsquo;s an easy fix here.  I can add an array to the constructor here that adds a string for $scope and since strings aren&rsquo;t minified, Angular has a way to match the name with the argument.  Let&rsquo;s go back into browser and refresh and make sure everything works.</p>

<p>Okay great, Next, we&rsquo;ll enable the loading states we created in the previous episode.  I&rsquo;ll set-up the initial loading state by adding  another attribute to the scope object:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// set-up loading state</span>
</span><span class='line'>  <span class="nx">$scope</span><span class="p">.</span><span class="nx">signupForm</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">loading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, don&rsquo;t be confused by my adding the <code>signupForm</code> attribute between the scope object and the loading attribute.  I&rsquo;m just gonna namespace everything concerning the signup form to under this attribute.  So when our submitSignupForm() function is executed we want the loading state to change to true. If we look at the markup and specifically the create account button, you can see what&rsquo;s changing based upon the loading state.  If the loading state is false, the button will display the Create Account text.  If it&rsquo;s true, the button will display our spinner animation with the text Preparing your new account within the button.  Okay, let&rsquo;s see if this works.  I&rsquo;ll go back to the signup page and since we have validation I need to put in some valid values and when I click the create account button you can see the loading state change.</p>

<p>So now let&rsquo;s add the ajax request to our function and we&rsquo;re going to do that with an Angular service $http. If you&rsquo;ve ever done an ajax request in jquery, this is going to look very familiar.  First, let&rsquo;s inject it into the function and the array like we did with the $scope object.  So we&rsquo;re going to put in the path and any data we want to send with the request.  In order to bind the form fields to these data attributes we&rsquo;re going to use $scope again.  And remember the $scope is linking the values that we&rsquo;re capturing in the mark-up via the ng-model directive.  So let&rsquo;s do that for the rest of our fields in the form.  We&rsquo;ve got title, and email, and password.  Okay great, now let&rsquo;s declare our success and error handlers.  So on success I want to change the location of the browser to <code>/user</code>.  This has the effect of making a <code>GET</code> request to <code>/user</code>.  If the request generates an error, I want to catch that error and for now just log the response.  Finally, I&rsquo;ll create this catchall function and either way I want to reset the loading state back to false.</p>

<p>We&rsquo;re now going to transition from the front-end to the back-end.  From the angular framework to the Sails framework.  Our goal is to create  a user by gathering up account information and sending it to Sails.  So let&rsquo;s implement some stuff and then I&rsquo;ll circle back and explain what we did in more detail.</p>

<p>Head over to the terminal and type sails generate api user.  With this simple set of commands and a bunch of tools and automation from Sails, we have almost everything we need for our API.  Start the Sails server by typing sails lift.</p>

<p>Because we created a model, Sails is asking us a question about migrations, we&rsquo;ll come back to this.  For now I&rsquo;m going to use the second option &mdash; <code>alter</code>.</p>

<p>Next, let&rsquo;s go into the browser and navigate to <code>localhost:1337/user</code>.  We&rsquo;ve just used one of Sails blueprint shortcut actions.  By navigating to &lsquo;/user&rsquo; we made a <code>GET</code> request to the server for all the user records.  And since we haven&rsquo;t created any records yet, not suprisingly we get an empty array.  But using the create action blueprint shortcut I&rsquo;ll create our first user record &mdash; Humphrey Bogart.  Sails also has blueprint rest or RESTful actions.  From within POSTMAN, really one of the best tool on the planet for testing routes, I&rsquo;ll make a POST request to /user with these route parameters for our next user Aimee Mann.   Chances are you&rsquo;ll create your own Controller Actions by the time you get to production.  However, Blueprints are incredibly useful in the design phase of your API.  If you interested in learning more about Blueprint capabilities, head over to this episode where I break them down in a bunch of detail.</p>

<p>So the path we want to associate with create a user is <code>/signup</code>.  So head back into the editor and open up <code>\config\routes.js</code>.  I&rsquo;m going to add the route <code>POST /signup</code> which will be handled by the <code>UserController.create</code> action. Let&rsquo;s restart Sails and navigate to the signup page.  Finally, I&rsquo;ll signup my hero Nikola Tesla.  And there&rsquo;s our list of records.</p>

<p>So briefly I want to go over what we&rsquo;ve done.  We created a route that connects the request to a controller and action. When the api was created, Sails provided us with a user controller and a create action (via blueprints) automatically.  Sails also created a user model that has model methods like .create, .find, .update, and .destroy.  Finally, the user model can retrieve and save records from a variety of databases via adapters.</p>

<p>In the next episode we&rsquo;ll transition from Sails blueprints to our custom action.  I&rsquo;ll also introduce a brand new Sails concept &mdash; node machines.  Thanks as always for watching and be sure to follow me on twitter and signup for the Sailscasts mailing list.  Also go checkout and signup for the beta of the Sails team&rsquo;s latest creation Treeline.io.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/">Building an Angular Application in Sails: Ep3 - Understanding Asset Delivery Options in Our SignUp Page.</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-20T16:12:00-06:00" pubdate data-updated="true">Jan 20<span>th</span>, 2015</time>
        
           | <a href="/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/#disqus_thread"
             data-disqus-identifier="http://irlnathan.github.io/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><iframe width="640" height="390" src="http://www.youtube.com/embed/4keciyLVPiM" frameborder="0" allowfullscreen></iframe>


<p>Follow me on twitter <a href="https://twitter.com/irlnathan">here</a>.</p>

<p>Subscribe to the sailscasts mailing list <a href="http://irlnathan.github.io/sailscastsnewsletter/">here</a>.</p>

<p>The repo for this episode can be found <a href="https://github.com/irlnathan/activityoverlord20">here</a>.</p>

<h1>Transcript</h1>

<p>In activityOverlord v1.0 the user interface or <code>Views</code> of the app were built primarily on the server before being sent to the client and rendered by the client&rsquo;s browser.  This approach is the <code>V</code> of the <strong>MVC architecture</strong> and also known as <strong>Server Rendering</strong> even though the web page is actually being rendered on the client&rsquo;s browser.</p>

<p>This so called <em>Server Rendering</em> is the server preprocessing one or more templates of markup, usually some combination of HTML, CSS, and Javascript and combining them with data via a <strong>Template Engine</strong>.  All <em>template engines</em> use some form of tags that surround variables that when processed yield a result.  Sails uses the EJS template engine by default.  For example, this template contains some standard HTML mark-up along with <code>EJS</code> tags.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;!DOCTYPE html&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>  &lt;head&gt;
</span><span class='line'>    &lt;title&gt;&lt;%- title %&gt;&lt;/title&gt;
</span><span class='line'>  &lt;/head&gt;
</span><span class='line'>  ...
</span></code></pre></td></tr></table></div></figure>


<p>Between the tags is a variable <code>title</code>.  When the Sails server processes this template it will attempt to replace the <code>title</code> variable with a value, hopefully the page title.  This is also called <strong>String Interpolation</strong>, but I only mention that because I&rsquo;m a geek.</p>

<h3>Server Rendered Views</h3>

<p>So let&rsquo;s review this approach. When a client browser makes a <code>request</code> to the server, the <code>router</code> parses the <code>request</code> and determines where to send it.  Now, the resulting <code>route</code> typically points to a <code>controller/action</code> that might execute some logic. For example, that logic might include accessing a mongo database that retrieves a stored twitter id and access token.  The id and token are then used to request additional details of the user from the Twitter API, all before the server pre-processes a template which contains tags with variables that are replaced by the Twitter details into a <code>View</code>.  The <code>View</code> is then sent back to the client and ultimately rendered by the browser.</p>

<p>Now, this traditional approach to web applications has at least two weaknesses.  First, its reliance on the server for page creation means the responsiveness of the app is impeded by the constant round trips necessary to update changes to the <code>View</code> from the server.  Second, is that the API being tightly coupled to the <code>View</code> makes it less flexible for other potential consumers to use.</p>

<p>A more modern approach to web applications solves both weaknesses by pushing the responsibility for changing the UI to the client as well as decoupling the API to act as an independent provider of endpoints.  These endpoints can then be accessed by the browser UI, a native app UI, a mobile UI, or even a smart refrigerator UI.</p>

<p>Now this doesn&rsquo;t mean that we&rsquo;ll be abandoning Server Rendered Views entirely.  Instead activityOverlordv2.0 will take a hybrid approach using a blend of Server Rendered Views combined with Front-end Framework Components to deliver a UI that makes authentication and SEO manageable.  But as usual I&rsquo;m getting ahead of myself.</p>

<p>So let&rsquo;s go back to the project and see what Server Rendered Views look like in action.  By default, Sails generated  three files &mdash; <code>homepage.ejs</code>, <code>layout.ejs</code>, and a route to the homepage contained in <code>/config/route.js</code>.  So when I make a request in the browser to localhost:1337, the Sails router looks at the request and matches it with the <code>route</code> in the routes file (e.g. <code>route.js</code>).  This triggers the <em>View Engine</em> to pre-process <code>layout.ejs</code> with <code>homepage.ejs</code> to produce the View that&rsquo;s being rendered by my browser.  The <code>Layout.ejs</code> file is actually a wrapper around <code>homepage.ejs</code>.  And what I mean by that is if we look at both files you can see that <code>layout.ejs</code> contains typical mark-up that we want for every page, things like DOCTYPE, html, and head tags.  So we have EJS tags here with a <code>body</code> variable which when processed by the Sails View Engine is replaced with the contents of <code>homepage.ejs</code> .  The result is our View.</p>

<p>Despite it&rsquo;s power, and to make this example crystal clear, I&rsquo;m going to disable the layout functionality in Views at least for the time being.  To do this I&rsquo;ll go into into /config/views.js and change the <code>layout</code> parameter from <code>layout</code> to false.</p>

<p>The first part of activityOverlord v2.0 consists of the <strong>Signup Page</strong> and when completed will look something like this.  Let&rsquo;s get started.  I&rsquo;ll first create a new file named <code>startup.ejs</code> and I&rsquo;ll put a simple header in it <code>&lt;h1&gt; Signup Page&lt;/h1&gt;</code>.  Next, I&rsquo;ll remove the existing <code>route</code> to the <code>homepage</code> and replace it with a <code>route</code> to the new <code>The Signup Page</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s1">&#39;GET /signup&#39;</span><span class="o">:</span> <span class="p">{</span><span class="nx">view</span><span class="o">:</span> <span class="s1">&#39;signup&#39;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s take a look.  I&rsquo;ll start Sails using <code>sails lift</code> and then navigate my browser to <code>localhost:1337/signup</code>.  Okay good, here&rsquo;s our signup page.</p>

<p>Let&rsquo;s go back to the <code>Signup Page</code> and I&rsquo;ll start by copying in some boilerplate <code>html</code>.  Next, I&rsquo;ll add our first <strong>Angular</strong> <code>directives</code> into the body tag &mdash; <code>ng-app</code>, <code>ng-controller</code>, and <code>ng-cloak</code>. Let&rsquo;s refresh the browser and see what happens.  Well nothing happens, because we haven&rsquo;t yet added Angular yet.  We could manually add the script tags that reference  Angular, however, Sails can do this automatically for us using it&rsquo;s own tagging system (e.g. <code>&lt;!--SCRIPTS--&gt;</code> <em>tag</em>).  You know what, it&rsquo;s easier just to show you.  So I&rsquo;ll add the <em>tags</em> to <code>signup.ejs</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Sign</span> <span class="nx">Up</span> <span class="k">for</span> <span class="nx">Activity</span> <span class="nx">Overlord</span> <span class="p">(</span><span class="nx">angular</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--</span> <span class="nx">Viewport</span> <span class="nx">mobile</span> <span class="nx">tag</span> <span class="k">for</span> <span class="nx">sensible</span> <span class="nx">mobile</span> <span class="nx">support</span> <span class="o">--&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">body</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">app</span><span class="o">=</span><span class="s2">&quot;SignupModule&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">&quot;SignupController&quot;</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">cloak</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">Signup</span> <span class="nx">Page</span>
</span><span class='line'>    <span class="c">&lt;!--</span><span class="nx">SCRIPTS</span><span class="o">--&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--</span><span class="nx">SCRIPTS</span> <span class="nx">END</span><span class="o">--&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;ll restart the Sails server using <code>Sails lift</code> and then go back into the browser but also open up the browser console&hellip;okay let&rsquo;s refresh the page and see what happens.  Okay, that new, we get this console message that we&rsquo;re &ldquo;connected to Sails&rdquo;, but where did that come from?  If we look at the page source we&rsquo;ll get a clue.  Towards the bottom of the page a link to a file named<code>sails.io.js</code> has been added to our signup page (e.g. <code>signup.ejs</code>).  But where did that link come from?   Let&rsquo;s go into our project in Sublime and navigate to <code>assets/js</code>.  In the dependencies foler there&rsquo;s our sails.io.js file.  First, this file deals with <code>web sockets</code> and <code>socket.io</code>, which we&rsquo;ll be covering in later episodes.  The big question now is, how did a link to that file get inserted into <code>signup.ejs</code>?  The short answer is that <strong>Grunt</strong> did it for us.  Okay, so what&rsquo;s <code>Grunt</code>?</p>

<p><code>Grunt</code> calls itself a <em>JavaScript Task Runner</em> but really <code>Grunt</code> is all about automation.  It allows you to create repetive tasks that can be executed automatically.  For example, there&rsquo;s a Grunt task that&rsquo;s looking for changes in the Sails assets folder.  Sails creates a .tmp folder in the root of our project.  As we can see here any files in the assets folder are copied into .tmp/public which acts like a static file folder you&rsquo;d find on any web server.  But what about the link to sails.io.js?  This is yet another Grunt Task that will place a link to any javascript file found in assets/js that has the corresponding Script tags we just placed in signup.ejs (e.g. <code>&lt;!--SCRIPTS--&gt;&lt;!--SCRIPTS END--&gt;</code>).</p>

<p>Of course all of these tasks are happening automatically without us having to be aware of them.  However, for those of you who want a little more detail behind the magic,  I created a doc that goes into much more specifics of the Grunt/Sails integration than I do in this screencast.  The documentation can be found <a href="https://github.com/irlnathan/s-grunt-docs/blob/master/overview.md">here</a>.</p>

<p>So let&rsquo;s go ahead and place the main Angular file in the <code>assets/js/dependencies</code> folder and I&rsquo;ll refresh the browser.  Looking at the page source we can see that a link to angular has been automatically placed in our signup page.  But when I refreshed the browser, Angular is mad at us because we have some directives in the signup page without any associated javascript files.  But not to worry, we can easily fix that.  Let&rsquo;s navigate back to the <code>assets/js</code> folder in Sublime and we&rsquo;ll create a folder called <code>public</code>.  We&rsquo;ll put all of our Angular files that have to do with those parts of the application that don&rsquo;t require authentication.  Within <code>public</code> we&rsquo;ll create a folder called <code>signup</code>.  And within <code>signup</code> we&rsquo;ll create two files SignupModule.js<code>and</code>SignupController.js<code>.  Okay, first let's take a look at</code>SignupModule.js` and  I&rsquo;ll add the bare bones Angular code to define our new module.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;SignupModule&#39;</span><span class="p">,</span> <span class="p">[]);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, I&rsquo;ll open <code>SignupController.js</code> and add the bare bones Angular code to define our new controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;SignupModule&#39;</span><span class="p">).</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;SignupController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go back to the browser and refresh the page.  As you can see, we still have an Angular issue.  If we look at the page source, we can see what the issue is, <code>SignupController</code> is getting loaded before <code>SignupModule</code>.  This is easy to fix and touches on another aspect of <strong>Grunt</strong>.  Most of the configuration for Grunt can be found within the <code>activityOverlord20/tasks</code> folder.  For this issue we&rsquo;re going to look in the root of the <code>tasks</code> folder for a file named <code>pipeline.js</code>.  This file contains the configuration for how the SCRIPTS tags are used (e.g. <code>&lt;!--SCRIPTS--&gt;</code>)  as well as some other tags we&rsquo;ll be using shortly.</p>

<p>Next, I&rsquo;ll open <code>pipeline.js</code> in Sublime.  We want to load the <code>SignupModule</code> after dependencies but before any other javascript files.  So we&rsquo;ll put the path to our file here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Dependencies like jQuery, or Angular are brought in here</span>
</span><span class='line'>  <span class="s1">&#39;js/dependencies/**/*.js&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// All of the rest of your client-side js files</span>
</span><span class='line'>  <span class="c1">// will be injected here in no particular order.</span>
</span><span class='line'>  <span class="s1">&#39;js/public/signup/SignupModule.js&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="s1">&#39;js/**/*.js&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now when I refresh the browser, Angular no longer complains and if look back at the page source we can see that SignUpModule is being loaded before SignupController.</p>

<p>So let&rsquo;s go back to signup.ejs in Sublime and insert the remainder of the markup for our Signup Page.   Let&rsquo;s start-up Sails using <code>Sails lift</code> and navigate the browser to localhost:1337/signup.  Although the page loads without errors, there&rsquo;s some obvious dependencies that need to be added in order for this page to look right.  First I&rsquo;ll add Bootstrap (e.g. <code>bootstrap.css</code>) to the <code>/assets/sytles</code> folder.  Similar to what we did with javascript files in the previous episode, Sails will automatically include links to the CSS in <code>signup.ejs</code>.  Taking a look at <code>signup.ejs</code> we can see the Styles tags that were added when I brought in the earlier mark-up as well as a link Grunt automatically created to the bootstrap file I just added.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>...
</span><span class='line'>
</span><span class='line'>    <span class="c">&lt;!--SCRIPTS--&gt;</span>
</span><span class='line'>    <span class="c">&lt;!--SCRIPTS END--&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, I&rsquo;m going to create a <code>fonts</code> folder and add some fonts we&rsquo;ll be using later in the interface.</p>

<p>I&rsquo;m also going to add some <code>.less</code> files into the <code>assets/styles</code> folder that we&rsquo;ll being using later in the interface as well.</p>

<p>You may have noticed the <code>importer.less</code> file which let&rsquo;s us control which less files are included the Styles Tag as well as their order.  Note that the Grunt task included in Sails will only compile the <code>.less</code> files that are referenced in this file.</p>

<p>I&rsquo;m also be adding Jesús Rodríguez&rsquo;s <a href="https://github.com/Foxandxss">https://github.com/Foxandxss</a> fantastic angular messaging library Angular-toastr.  The library contains both a javascript and a css file.</p>

<p>Finally, I&rsquo;ll add the <code>CompareTo</code> Angular Directive which will help us with comparing the value of form fields.  I&rsquo;ll place it in the <code>/js/dependencies</code> folder.</p>

<p>So let&rsquo;s see where we are after these dependencies were added.  I&rsquo;ll head back to the browser refresh the page.  The console displays an <code>Uncaught reference error that Angular is not defined.</code>  Since this is coming from the <code>toastr</code> library my hunch is that we have a loading order error. And sure enough if we look at the page source, the <code>toaster</code> library is being loaded before Angular.   I&rsquo;ll head back to our project and <code>pipeline.js</code> in sublime and add a reference to Angular here (e.g. <code>'js/dependencies/angular.1.3.js',</code>) that will load Angular first before any of the other depedencies.</p>

<p>Let&rsquo;s head back to the browser and refresh the page.   Great, there&rsquo;s no longer and error.</p>

<p>Now let&rsquo;s take a look at some form validation in signup.ejs.  There are three components to the form field validation we&rsquo;re going to perform.  So taking a look at the name field.  We first use the ng-class directive to create the <code>has-error</code> class if the field name is invalid and dirty.  This will insert a red border around the input field.  Next we&rsquo;ll configure the validation parameters of the field itself.  In this case we&rsquo;re requiring that the field have a value as well as have a maxlength of 50 characters.  Finally, we&rsquo;ll set-up the text for our error message here.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- Also, if signup.name.$dirty is true, show the message depending upon the particular properties truthiness (e.g. required</span>
</span><span class='line'><span class="c">and/or maxlength) --&gt;</span>
</span><span class='line'><span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.name.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.name.$error.required&quot;</span><span class="nt">&gt;</span>Name is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.name.$error.maxlength&quot;</span><span class="nt">&gt;</span>The name cannot be more than 50 characters.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/span&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s see this in action.  I&rsquo;ll go back to the browser and type in a name.  Now If I remove the name, the required validation is triggered and if I add to many character&rsquo;s the maxlength validation will be triggered.</p>

<p>Let&rsquo;s go back to signup.ejs and review the remaining form fields configuration.</p>

<p>So the Title field&rsquo;s configuration is identical to the name, the title is required and has a max length of 50 characters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- T I T L E --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-12&quot;</span>
</span><span class='line'>  <span class="na">ng-class=</span><span class="s">&quot;{&#39;has-error&#39;:signup.title.$invalid &amp;&amp;</span>
</span><span class='line'><span class="s">                        signup.title.$dirty}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Your title<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;e.g. Genius&quot;</span> <span class="na">name=</span><span class="s">&quot;title&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.title&quot;</span> <span class="na">ng-maxlength=</span><span class="s">&quot;50&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.title.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.title.$error.required&quot;</span><span class="nt">&gt;</span>Title is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.title.$error.maxlength&quot;</span><span class="nt">&gt;</span>The name cannot be more than 50 characters.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Email field is required and requires a properly formatted email address.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- E M A I L --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-12&quot;</span>
</span><span class='line'><span class="na">ng-class=</span><span class="s">&quot;{&#39;has-error&#39;:signup.email.$invalid &amp;&amp;</span>
</span><span class='line'><span class="s">                      signup.email.$dirty}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Your email address<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;email&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;nikola@tesla.com&quot;</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.email&quot;</span> <span class="na">required</span> <span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.email.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.email.$error.required&quot;</span><span class="nt">&gt;</span>Email address is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.email.$error.email&quot;</span><span class="nt">&gt;</span>Not a valid email address.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Password field is required and must be at least 6 characters.  Also notice that we&rsquo;re using the CompareTo directive to compare the password field with the confirmPassword model.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- P A S S W O R D --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-6&quot;</span>
</span><span class='line'><span class="na">ng-class=</span><span class="s">&quot;{&#39;has-error&#39;:signup.password.$invalid &amp;&amp;</span>
</span><span class='line'><span class="s">                      signup.password.$dirty}&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Choose a password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="c">&lt;!-- Added the compareTo directive that compares the passowrds --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;at least 6 characters&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span> <span class="na">required</span> <span class="na">ng-minlength=</span><span class="s">&quot;6&quot;</span> <span class="na">compare-to=</span><span class="s">&quot;signupForm.confirmPassword&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.password.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.password.$error.required&quot;</span><span class="nt">&gt;</span>Password is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.password.$error.minlength&quot;</span><span class="nt">&gt;</span>Password must be at least 6 characters.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Password Confirmation field is required and must match the Password Field.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- C O N F I R M  P A S S W O R D --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group form-group col-md-6&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;label&gt;</span>Re-enter your password<span class="nt">&lt;/label&gt;</span>
</span><span class='line'>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">class=</span><span class="s">&quot;form-control&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;one more time&quot;</span> <span class="na">name=</span><span class="s">&quot;confirmation&quot;</span> <span class="na">ng-model=</span><span class="s">&quot;signupForm.confirmPassword&quot;</span> <span class="na">required</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;help-block has-error&quot;</span> <span class="na">ng-if=</span><span class="s">&quot;signup.confirmation.$dirty&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.password.$error.compareTo&quot;</span><span class="nt">&gt;</span>Password must match.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>    <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signup.confirmation.$error.required&quot;</span><span class="nt">&gt;</span>Confirmation password is required.<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally, we disable the form submission button via the <code>ng-diabled</code> directive until all of the form fields have valid values.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- C O N F I R M  P A S S W O R D --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!-- Disable signup button until the form has no errors --&gt;</span>
</span><span class='line'><span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary btn-lg btn-block&quot;</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">ng-disabled=</span><span class="s">&quot;signup.$invalid&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;!signupForm.loading&quot;</span><span class="nt">&gt;</span>Create Account<span class="nt">&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;overlord-loading-spinner fa fa-spinner&quot;</span> <span class="na">ng-show=</span><span class="s">&quot;signupForm.loading&quot;</span> <span class="nt">&gt;&lt;/span&gt;</span>
</span><span class='line'>  <span class="nt">&lt;span</span> <span class="na">ng-show=</span><span class="s">&quot;signupForm.loading&quot;</span><span class="nt">&gt;</span>Preparing your new account...<span class="nt">&lt;/span&gt;</span>
</span><span class='line'><span class="nt">&lt;/button&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Okay let&rsquo;s go back and take a look at the validations in action.  I&rsquo;m going to refresh the browser.</p>

<p>Believe it or not that rounds out our signup page.  In the next episode we&rsquo;ll start to flesh out our initial API that connects the signup page with an endpoint that creates a user account via a model into a database.</p>

<p>You can find all of the source code for this episode at the activityOverlord20 repo on github.</p>

<p>And If have a moment plese follow me on twitter and be sure to signup for the Sailscasts mailing list so I can finally prove to my wife that there are actually folks watching this stuff.  As always thanks for watching.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/sailscasts/blog/page/2/">&larr; Older</a>
    
    <a href="/sailscasts/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/sailscasts/blog/2015/04/04/building-an-angular-application-in-sails-ep6-user-authentication-in-angular-and-sails/">Building an Angular Application in Sails: Ep6 - User Authentication in Angular and Sails.</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2015/03/10/building-an-angular-application-in-treeline-sneak-peak-implementing-the-signup-page-in-treeline/">Building an Angular Application in Treeline Sneak Peak: Implementing the Signup Page in Treeline.</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-creating-custom-actions-and-an-intro-to-node-machines/">Building an Angular Application in Sails: Ep5 - Creating Custom Actions and an Intro to Node-machines.</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2015/03/06/building-an-angular-application-in-sails-ep4-implementing-requests-in-angular-to-a-sails-api/">Building an Angular Application in Sails: Ep4 - Implementing Requests in Angular to a Sails API.</a>
      </li>
    
      <li class="post">
        <a href="/sailscasts/blog/2015/01/20/building-an-angular-application-in-sails-ep3-understanding-asset-delivery-options-in-our-signup-page/">Building an Angular Application in Sails: Ep3 - Understanding Asset Delivery Options in Our SignUp Page.</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - irl nathan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sailscasts';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
